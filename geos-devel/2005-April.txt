From hobu at iastate.edu  Sat Apr  2 09:31:48 2005
From: hobu at iastate.edu (Howard Butler)
Date: Fri Nov  2 20:52:40 2007
Subject: [geos-devel] setup.py for Python SWIG wrappers
Message-ID: <p0620070abe745c26cd91@[192.168.254.9]>

All,

I had to make a few adjustments to the setup.py file for the Python 
SWIG wrappers to get them to work nicely with MSVC 2003 and Python 
2.4.  I also added a version number and some package metadata.  A 
patch is attached.

Also, using the bdist_wininst distutils target, I made a Python 2.4 
windows installer of the wrappers and made it available at 
<http://hobu.biz/software/PyGEOS>

Howard
-------------- next part --------------
A non-text attachment was scrubbed...
Name: setup.py.patch
Type: application/octet-stream
Size: 1718 bytes
Desc: not available
Url : http://lists.osgeo.org/pipermail/geos-devel/attachments/20050402/8aa597cf/setup.py.obj
From strk at refractions.net  Mon Apr  4 08:38:06 2005
From: strk at refractions.net (strk@refractions.net)
Date: Fri Nov  2 20:52:40 2007
Subject: [geos-devel] setup.py for Python SWIG wrappers
In-Reply-To: <p0620070abe745c26cd91@[192.168.254.9]>
References: <p0620070abe745c26cd91@[192.168.254.9]>
Message-ID: <20050404123806.GD30306@freek.keybit.net>

Applyed by Sean Gillies. 
The present to let parties know..
Thanks to all.
--strk;

On Sat, Apr 02, 2005 at 08:31:48AM -0600, Howard Butler wrote:
> All,
> 
> I had to make a few adjustments to the setup.py file for the Python 
> SWIG wrappers to get them to work nicely with MSVC 2003 and Python 
> 2.4.  I also added a version number and some package metadata.  A 
> patch is attached.
> 
> Also, using the bdist_wininst distutils target, I made a Python 2.4 
> windows installer of the wrappers and made it available at 
> <http://hobu.biz/software/PyGEOS>
> 
> Howard


> _______________________________________________
> geos-devel mailing list
> geos-devel@geos.refractions.net
> http://geos.refractions.net/mailman/listinfo/geos-devel


From niki.spahiev at gmail.com  Mon Apr  4 10:58:13 2005
From: niki.spahiev at gmail.com (Niki Spahiev)
Date: Fri Nov  2 20:52:40 2007
Subject: [geos-devel] setup.py for Python SWIG wrappers
In-Reply-To: <20050404123806.GD30306@freek.keybit.net>
References: <p0620070abe745c26cd91@192.168.254.9>
	<20050404123806.GD30306@freek.keybit.net>
Message-ID: <67c2293205040407584e56415a@mail.gmail.com>

Not very good. 
sys.platform == 'win32' does not mean using MSVC.
GCC on win32 is not compatible with this patch

From sgillies at frii.com  Mon Apr  4 20:34:26 2005
From: sgillies at frii.com (Sean Gillies)
Date: Fri Nov  2 20:52:40 2007
Subject: [geos-devel] setup.py for Python SWIG wrappers
In-Reply-To: <67c2293205040407584e56415a@mail.gmail.com>
References: <p0620070abe745c26cd91@192.168.254.9>
	<20050404123806.GD30306@freek.keybit.net>
	<67c2293205040407584e56415a@mail.gmail.com>
Message-ID: <b4f9d1a7733a9965df261bb021dbf42f@frii.com>

On Apr 4, 2005, at 8:58 AM, Niki Spahiev wrote:

> Not very good.
> sys.platform == 'win32' does not mean using MSVC.
> GCC on win32 is not compatible with this patch

Let's try to get this fixed soon.  It seems to me that the 'win32' 
platform should be understood to be the default windows builds of 
Python using VC6 (Python <2.3) or MSVC .NET (Python 2.4).  This will be 
the environment of the great majority of windows users, yes?  Evidently 
the sys module can't distinguish between these and a custom GCC Python. 
  Any ideas?

cheers,
Sean

--
Sean Gillies
sgillies at frii dot com
http://users.frii.com/sgillies


From niki.spahiev at gmail.com  Tue Apr  5 08:00:05 2005
From: niki.spahiev at gmail.com (Niki Spahiev)
Date: Fri Nov  2 20:52:40 2007
Subject: [geos-devel] setup.py for Python SWIG wrappers
In-Reply-To: <b4f9d1a7733a9965df261bb021dbf42f@frii.com>
References: <p0620070abe745c26cd91@192.168.254.9>
	<20050404123806.GD30306@freek.keybit.net>
	<67c2293205040407584e56415a@mail.gmail.com>
	<b4f9d1a7733a9965df261bb021dbf42f@frii.com>
Message-ID: <67c2293205040505001b816df6@mail.gmail.com>

> On Apr 4, 2005, at 8:58 AM, Niki Spahiev wrote:
> 
> > Not very good.
> > sys.platform == 'win32' does not mean using MSVC.
> > GCC on win32 is not compatible with this patch
> 
> Let's try to get this fixed soon.  It seems to me that the 'win32'
> platform should be understood to be the default windows builds of
> Python using VC6 (Python <2.3) or MSVC .NET (Python 2.4).  This will be
> the environment of the great majority of windows users, yes?  Evidently
> the sys module can't distinguish between these and a custom GCC Python.
>   Any ideas?

There is no GCC Python. GCC (mingw) compiles modules for standard win32 python.


Niki Spahiev

From jon.schlueter at gmail.com  Tue Apr  5 16:51:01 2005
From: jon.schlueter at gmail.com (Jon Schlueter)
Date: Fri Nov  2 20:52:40 2007
Subject: [geos-devel] cygwin Compile Error
In-Reply-To: <20050218171814.GE71420@freek.keybit.net>
References: <bd1f1cc905021614155451657a@mail.gmail.com>
	<20050217094343.GD56817@freek.keybit.net>
	<bd1f1cc905021710245272db74@mail.gmail.com>
	<20050218171814.GE71420@freek.keybit.net>
Message-ID: <bd1f1cc9050405135128643fab@mail.gmail.com>

On Feb 18, 2005 1:18 PM, strk@refractions.net <strk@refractions.net> wrote:
> On Thu, Feb 17, 2005 at 01:24:59PM -0500, Jon Schlueter wrote:
> > update,
> >
> > I found multiple math.h includes but the only thing that I could find
> > that would get it to compile under cygwin was to make ieeefp.h extern
> > "C" with the following
> 
> Didn't using <cmath> all over work (I don't think we should have
> direct .h inclusions anyway)
> --strk;
> 

Update on Compile Status under Windows using Cygwin

I finally had a bit of time to check things out again

With the the attached diff file changes to the current CVS tree I was
able to compile and run the test programs.
System:
    Windows XP Pro - Cygwin - gcc  (GCC) 3.3.3 (cygwin special)

Jon Schlueter
-------------- next part --------------
? diff.txt
Index: source/algorithm/CGAlgorithms.cpp
===================================================================
RCS file: /home/cvs/postgis/geos/source/algorithm/CGAlgorithms.cpp,v
retrieving revision 1.21
diff -b -r1.21 CGAlgorithms.cpp
18c18
< #include <math.h>
---
> #include <cmath>
Index: source/algorithm/LineIntersector.cpp
===================================================================
RCS file: /home/cvs/postgis/geos/source/algorithm/LineIntersector.cpp,v
retrieving revision 1.22
diff -b -r1.22 LineIntersector.cpp
19c19
< #include <math.h>
---
> #include <cmath>
Index: source/algorithm/NonRobustLineIntersector.cpp
===================================================================
RCS file: /home/cvs/postgis/geos/source/algorithm/NonRobustLineIntersector.cpp,v
retrieving revision 1.9
diff -b -r1.9 NonRobustLineIntersector.cpp
31c31
< #include <math.h>
---
> #include <cmath>
Index: source/algorithm/RobustDeterminant.cpp
===================================================================
RCS file: /home/cvs/postgis/geos/source/algorithm/RobustDeterminant.cpp,v
retrieving revision 1.6
diff -b -r1.6 RobustDeterminant.cpp
29c29
< #include <math.h>
---
> #include <cmath>
Index: source/bigtest/GeometryTestFactory.cpp
===================================================================
RCS file: /home/cvs/postgis/geos/source/bigtest/GeometryTestFactory.cpp,v
retrieving revision 1.12
diff -b -r1.12 GeometryTestFactory.cpp
16c16
< #include <math.h>
---
> #include <cmath>
Index: source/geomgraph/DirectedEdge.cpp
===================================================================
RCS file: /home/cvs/postgis/geos/source/geomgraph/DirectedEdge.cpp,v
retrieving revision 1.2
diff -b -r1.2 DirectedEdge.cpp
32c32
< #include <math.h>
---
> #include <cmath>
Index: source/geomgraph/EdgeEnd.cpp
===================================================================
RCS file: /home/cvs/postgis/geos/source/geomgraph/EdgeEnd.cpp,v
retrieving revision 1.4
diff -b -r1.4 EdgeEnd.cpp
21c21
< #include <math.h>
---
> #include <cmath>
Index: source/geomgraph/index/SegmentIntersector.cpp
===================================================================
RCS file: /home/cvs/postgis/geos/source/geomgraph/index/SegmentIntersector.cpp,v
retrieving revision 1.7
diff -b -r1.7 SegmentIntersector.cpp
18c18
< #include <math.h>
---
> #include <cmath>
Index: source/headers/geos/platform.h.in
===================================================================
RCS file: /home/cvs/postgis/geos/source/headers/geos/platform.h.in,v
retrieving revision 1.6
diff -b -r1.6 platform.h.in
13a14,15
> extern "C"
> {
14a17
> };
Index: source/noding/snapround/SegmentSnapper.cpp
===================================================================
RCS file: /home/cvs/postgis/geos/source/noding/snapround/SegmentSnapper.cpp,v
retrieving revision 1.3
diff -b -r1.3 SegmentSnapper.cpp
33c33
< #include <math.h>
---
> #include <cmath>
Index: source/planargraph/planarDirectedEdge.cpp
===================================================================
RCS file: /home/cvs/postgis/geos/source/planargraph/planarDirectedEdge.cpp,v
retrieving revision 1.8
diff -b -r1.8 planarDirectedEdge.cpp
18c18
< #include <math.h>
---
> #include <cmath>
From strk at refractions.net  Wed Apr  6 07:07:52 2005
From: strk at refractions.net (strk@refractions.net)
Date: Fri Nov  2 20:52:40 2007
Subject: [geos-devel] cygwin Compile Error
In-Reply-To: <bd1f1cc9050405135128643fab@mail.gmail.com>
References: <bd1f1cc905021614155451657a@mail.gmail.com>
	<20050217094343.GD56817@freek.keybit.net>
	<bd1f1cc905021710245272db74@mail.gmail.com>
	<20050218171814.GE71420@freek.keybit.net>
	<bd1f1cc9050405135128643fab@mail.gmail.com>
Message-ID: <20050406110752.GI50366@freek.keybit.net>

Committed. Thanks.
--strk;

On Tue, Apr 05, 2005 at 04:51:01PM -0400, Jon Schlueter wrote:
> On Feb 18, 2005 1:18 PM, strk@refractions.net <strk@refractions.net> wrote:
> > On Thu, Feb 17, 2005 at 01:24:59PM -0500, Jon Schlueter wrote:
> > > update,
> > >
> > > I found multiple math.h includes but the only thing that I could find
> > > that would get it to compile under cygwin was to make ieeefp.h extern
> > > "C" with the following
> > 
> > Didn't using <cmath> all over work (I don't think we should have
> > direct .h inclusions anyway)
> > --strk;
> > 
> 
> Update on Compile Status under Windows using Cygwin
> 
> I finally had a bit of time to check things out again
> 
> With the the attached diff file changes to the current CVS tree I was
> able to compile and run the test programs.
> System:
>     Windows XP Pro - Cygwin - gcc  (GCC) 3.3.3 (cygwin special)
> 
> Jon Schlueter

> ? diff.txt
> Index: source/algorithm/CGAlgorithms.cpp
> ===================================================================
> RCS file: /home/cvs/postgis/geos/source/algorithm/CGAlgorithms.cpp,v
> retrieving revision 1.21
> diff -b -r1.21 CGAlgorithms.cpp
> 18c18
> < #include <math.h>
> ---
> > #include <cmath>
> Index: source/algorithm/LineIntersector.cpp
> ===================================================================
> RCS file: /home/cvs/postgis/geos/source/algorithm/LineIntersector.cpp,v
> retrieving revision 1.22
> diff -b -r1.22 LineIntersector.cpp
> 19c19
> < #include <math.h>
> ---
> > #include <cmath>
> Index: source/algorithm/NonRobustLineIntersector.cpp
> ===================================================================
> RCS file: /home/cvs/postgis/geos/source/algorithm/NonRobustLineIntersector.cpp,v
> retrieving revision 1.9
> diff -b -r1.9 NonRobustLineIntersector.cpp
> 31c31
> < #include <math.h>
> ---
> > #include <cmath>
> Index: source/algorithm/RobustDeterminant.cpp
> ===================================================================
> RCS file: /home/cvs/postgis/geos/source/algorithm/RobustDeterminant.cpp,v
> retrieving revision 1.6
> diff -b -r1.6 RobustDeterminant.cpp
> 29c29
> < #include <math.h>
> ---
> > #include <cmath>
> Index: source/bigtest/GeometryTestFactory.cpp
> ===================================================================
> RCS file: /home/cvs/postgis/geos/source/bigtest/GeometryTestFactory.cpp,v
> retrieving revision 1.12
> diff -b -r1.12 GeometryTestFactory.cpp
> 16c16
> < #include <math.h>
> ---
> > #include <cmath>
> Index: source/geomgraph/DirectedEdge.cpp
> ===================================================================
> RCS file: /home/cvs/postgis/geos/source/geomgraph/DirectedEdge.cpp,v
> retrieving revision 1.2
> diff -b -r1.2 DirectedEdge.cpp
> 32c32
> < #include <math.h>
> ---
> > #include <cmath>
> Index: source/geomgraph/EdgeEnd.cpp
> ===================================================================
> RCS file: /home/cvs/postgis/geos/source/geomgraph/EdgeEnd.cpp,v
> retrieving revision 1.4
> diff -b -r1.4 EdgeEnd.cpp
> 21c21
> < #include <math.h>
> ---
> > #include <cmath>
> Index: source/geomgraph/index/SegmentIntersector.cpp
> ===================================================================
> RCS file: /home/cvs/postgis/geos/source/geomgraph/index/SegmentIntersector.cpp,v
> retrieving revision 1.7
> diff -b -r1.7 SegmentIntersector.cpp
> 18c18
> < #include <math.h>
> ---
> > #include <cmath>
> Index: source/headers/geos/platform.h.in
> ===================================================================
> RCS file: /home/cvs/postgis/geos/source/headers/geos/platform.h.in,v
> retrieving revision 1.6
> diff -b -r1.6 platform.h.in
> 13a14,15
> > extern "C"
> > {
> 14a17
> > };
> Index: source/noding/snapround/SegmentSnapper.cpp
> ===================================================================
> RCS file: /home/cvs/postgis/geos/source/noding/snapround/SegmentSnapper.cpp,v
> retrieving revision 1.3
> diff -b -r1.3 SegmentSnapper.cpp
> 33c33
> < #include <math.h>
> ---
> > #include <cmath>
> Index: source/planargraph/planarDirectedEdge.cpp
> ===================================================================
> RCS file: /home/cvs/postgis/geos/source/planargraph/planarDirectedEdge.cpp,v
> retrieving revision 1.8
> diff -b -r1.8 planarDirectedEdge.cpp
> 18c18
> < #include <math.h>
> ---
> > #include <cmath>

> _______________________________________________
> geos-devel mailing list
> geos-devel@geos.refractions.net
> http://geos.refractions.net/mailman/listinfo/geos-devel


From strk at refractions.net  Thu Apr  7 14:41:27 2005
From: strk at refractions.net (strk@refractions.net)
Date: Fri Nov  2 20:52:40 2007
Subject: [geos-devel] Re: [jts-devel] Re: [postgis-devel] Possible Bug in
	isvalid()
In-Reply-To: <5A94289A9268514C8D6C0F1FF44BA02796CC90@venus.VividSolutions.com>
References: <5A94289A9268514C8D6C0F1FF44BA02796CC90@venus.VividSolutions.com>
Message-ID: <20050407184127.GB65310@freek.keybit.net>

On Thu, Apr 07, 2005 at 10:37:10AM -0700, Martin Davis wrote:
> This bug is now fixed in CVS.

Fixed in GEOS CVS also. Thanks.
--strk;

> 
> Fix is in IsValidOp#checkHolesInShell to replace line
> 
>       Assert.isTrue(holePt != null, "Unable to find a hole point not a
> vertex of the shell");
> 
> With
> 
>       if (holePt == null) return;
> 
> 
> Martin Davis, Senior Technical Architect
> Vivid Solutions Inc.      www.vividsolutions.com
> Suite #1A-2328 Government Street Victoria, B.C. V8T 5G5
> Phone: (250) 385 6040 - Local 308 Fax: (250) 385 6046
> 
> 
> > -----Original Message-----
> > From: strk@refractions.net [mailto:strk@refractions.net] 
> > Sent: April 7, 2005 3:10 AM
> > To: PostGIS Development Discussion; JTS Topology Suite Development
> > Subject: Re: [jts-devel] Re: [postgis-devel] Possible Bug in isvalid()
> > 
> > 
> > Maybe the "inner" classes facing these kind of errors should 
> > throw a ValidityException instead so that the IsValid class 
> > could catch them ...
> > 
> > --strk;
> > 
> > On Thu, Apr 07, 2005 at 11:57:30AM +0200, Markus Schaber wrote:
> > > Hi,
> > > 
> > > (Added X-Post to JTS Developers list.)
> > > 
> > > Markus Schaber schrieb:
> > > > I just tried to apply my isvalid constraint to our raw 
> > data tables, 
> > > > and got the following error message on one of them:
> > > > 
> > > > NOTICE:  AssertionFailedException: Unable to find a hole 
> > point not a 
> > > > vertex of the shell
> > > > ERROR:  GEOS isvalid() threw an error!
> > > > 
> > > > This sounds rather strange to me. IMHO, it should not be 
> > possible to 
> > > > make isvalid() throw an error by feeding it an invalid geometry.
> > > >
> > > > I'll try to track down which geometries cause this error 
> > message...
> > > 
> > > I now got a simple example:
> > > 
> > > > gisblau=# select isvalid('MULTIPOLYGON(((0 0, 10 10, 10 
> > 0, 0 0),(5 
> > > > 5, 5 0, 10 5, 5 5)))');
> > > > NOTICE:  AssertionFailedException: Unable to find a hole 
> > point not a vertex of the shell
> > > > ERROR:  GEOS isvalid() threw an error!
> > > 
> > > The attached small java program triggers this error on my machine 
> > > against jts-1.6.jar.
> > > 
> > > HTH,
> > > Markus
> > 
> > 
> > > _______________________________________________
> > > jts-devel mailing list
> > > jts-devel@lists.jump-project.org 
> > > http://lists.refractions.net/mailman/listinfo/jts-devel
> > 
> > _______________________________________________
> > jts-devel mailing list
> > jts-devel@lists.jump-project.org 
> > http://lists.refractions.net/mailman/listinfo/jts-devel
> > 
> _______________________________________________
> jts-devel mailing list
> jts-devel@lists.jump-project.org
> http://lists.refractions.net/mailman/listinfo/jts-devel

From sgillies at frii.com  Fri Apr  8 10:46:51 2005
From: sgillies at frii.com (Sean Gillies)
Date: Fri Nov  2 20:52:40 2007
Subject: [geos-devel] setup.py for Python SWIG wrappers
In-Reply-To: <67c2293205040505001b816df6@mail.gmail.com>
References: <p0620070abe745c26cd91@192.168.254.9>
	<20050404123806.GD30306@freek.keybit.net>
	<67c2293205040407584e56415a@mail.gmail.com>
	<b4f9d1a7733a9965df261bb021dbf42f@frii.com>
	<67c2293205040505001b816df6@mail.gmail.com>
Message-ID: <5fb0de52faa7b87151f895dd08aa725d@frii.com>

On Apr 5, 2005, at 6:00 AM, Niki Spahiev wrote:

>> On Apr 4, 2005, at 8:58 AM, Niki Spahiev wrote:
>>
>>> Not very good.
>>> sys.platform == 'win32' does not mean using MSVC.
>>> GCC on win32 is not compatible with this patch
>>
>> Let's try to get this fixed soon.  It seems to me that the 'win32'
>> platform should be understood to be the default windows builds of
>> Python using VC6 (Python <2.3) or MSVC .NET (Python 2.4).  This will 
>> be
>> the environment of the great majority of windows users, yes?  
>> Evidently
>> the sys module can't distinguish between these and a custom GCC 
>> Python.
>>   Any ideas?
>
> There is no GCC Python. GCC (mingw) compiles modules for standard 
> win32 python.
>
>
> Niki Spahiev

OK, now I understand.  This will be tricky.  How to detect which 
compiler is going to be used on windows?  If the compiler were 
specified on the command line like

     python setup.py build --compiler=mingw

it would be easy, just sys.argv[2].  But if users are specifying the 
compiler in a setup.cfg file, then this doesn't work and the compiler 
isn't even set until the build target is evaluated.

Any ideas, Niki?

Sean

--
Sean Gillies
sgillies at frii dot com
http://users.frii.com/sgillies


From strk at refractions.net  Fri Apr  8 12:27:24 2005
From: strk at refractions.net (strk@refractions.net)
Date: Fri Nov  2 20:52:40 2007
Subject: [geos-devel] setup.py for Python SWIG wrappers
In-Reply-To: <5fb0de52faa7b87151f895dd08aa725d@frii.com>
References: <p0620070abe745c26cd91@192.168.254.9>
	<20050404123806.GD30306@freek.keybit.net>
	<67c2293205040407584e56415a@mail.gmail.com>
	<b4f9d1a7733a9965df261bb021dbf42f@frii.com>
	<67c2293205040505001b816df6@mail.gmail.com>
	<5fb0de52faa7b87151f895dd08aa725d@frii.com>
Message-ID: <20050408162724.GC75450@freek.keybit.net>

On Fri, Apr 08, 2005 at 08:46:51AM -0600, Sean Gillies wrote:
...
> OK, now I understand.  This will be tricky.  How to detect which 
> compiler is going to be used on windows?  If the compiler were 
> specified on the command line like
> 
>     python setup.py build --compiler=mingw
> 
> it would be easy, just sys.argv[2].  But if users are specifying the 
> compiler in a setup.cfg file, then this doesn't work and the compiler 
> isn't even set until the build target is evaluated.

GEOS uses autoconf, either generating a Makefile for python dir
or having python's Makefile include a global Makefile.config 
should do. I'm not a win32 user, so can't check it myself, but
looking for "mingw" or "gcc" or "whatever" in your generated
Makefiles would be a good start.

--strk;

From sd_shancheng at yahoo.com.cn  Thu Apr 14 06:23:17 2005
From: sd_shancheng at yahoo.com.cn (Cheng Shan)
Date: Fri Nov  2 20:52:40 2007
Subject: [geos-devel] Performance enhance in Parsing WKT data
Message-ID: <20050414102317.62698.qmail@web15010.mail.cnb.yahoo.com>

Hello,
    These days I have been using GEOS to parse WKT
format data. And I found that the performance decreace
dramatically when loading big geometry. For my result,
it takes 24~30 second to load 337 geometry. But it
needs only about 2~3 second when using JTS. I suspect
there are somethings wrong.
    After about two days study, I found that the class
"StringTokenizer" allocate and deallocate memory
frequently.
So I made some modification on the class. Now it takes
3~4 second to load the same data. And the tests passed
without any problem.
    Also I modify the type of the function
WKTReader::read's parameter "wellKnownText" from
"string" to "const string&", this can avoid the copy
of the argument.
    Maybe the work is useful. And I would like to
share it with all people who use the project GEOS. The
following is the difference list:
? build
Index: source/headers/geos/io.h
===================================================================
RCS file:
/home/cvs/postgis/geos/source/headers/geos/io.h,v
retrieving revision 1.5
diff -u -r1.5 io.h
--- source/headers/geos/io.h 19 Jul 2004 10:33:12
-0000 1.5
+++ source/headers/geos/io.h 14 Apr 2005 09:16:40
-0000
@@ -92,16 +92,17 @@
   TT_WORD
  };
  StringTokenizer();
- StringTokenizer(string txt);
+ StringTokenizer(const string& txt);
  ~StringTokenizer();
  int nextToken();
  int peekNextToken();
  double getNVal();
  string getSVal();
 private:
- string str;
+ const string str;
  string stok;
  double ntok;
+ string::const_iterator iter;
 };
 
 /**
@@ -125,7 +126,7 @@
  ~WKTReader();
 
  /// Parse a WKT string returning a Geometry
- Geometry* read(string wellKnownText);
+ Geometry* read(const string& wellKnownText);
 
 // Geometry* read(Reader reader); //Not implemented
yet
 
Index: source/io/StringTokenizer.cpp
===================================================================
RCS file:
/home/cvs/postgis/geos/source/io/StringTokenizer.cpp,v
retrieving revision 1.11
diff -u -r1.11 StringTokenizer.cpp
--- source/io/StringTokenizer.cpp 2 Jul 2004 13:28:27
-0000 1.11
+++ source/io/StringTokenizer.cpp 14 Apr 2005 09:16:42
-0000
@@ -39,59 +39,57 @@
 
 namespace geos {
 
-StringTokenizer::StringTokenizer(){
- str="";
+StringTokenizer::StringTokenizer()
+ :str("") {
  stok="";
  ntok=0.0;
+ iter=str.begin();
 }
-StringTokenizer::StringTokenizer(string txt) {
- str=txt;
+StringTokenizer::StringTokenizer(const string& txt)
+ : str(txt) {
  stok="";
  ntok=0.0;
+ iter=str.begin();
 }
 StringTokenizer::~StringTokenizer(){}
 
-int StringTokenizer::nextToken(){
+int StringTokenizer::nextToken() {
  string tok="";
- if (str.size()==0)
+ if (iter==str.end())
   return StringTokenizer::TT_EOF;
- switch(str[0]) {
-  case '(':
-   str=str.substr(1);
-   return '(';
-  case ')':
-   str=str.substr(1);
-   return ')';
-  case ',':
-   str=str.substr(1);
-   return ',';
-  case '\n':
-  case '\r':
-  case '\t':
-  case ' ':
-   string::size_type pos=str.find_first_not_of("
\n\r\t");
-   if (pos==string::npos) {
-    return StringTokenizer::TT_EOF;
-   } else {
-    str=str.substr(pos);
-    return nextToken();
-   }
-  }
- string::size_type pos=str.find_first_of("\n\r\t()
,");
+ switch (*iter) {
+ case '(':
+ case ')':
+ case ',':
+  return *iter++;
+ case '\n':
+ case '\r':
+ case '\t':
+ case ' ':
+  string::size_type pos=str.find_first_not_of("
\n\r\t",iter-str.begin());
+  if (pos==string::npos) {
+   return StringTokenizer::TT_EOF;
+  } else {
+   iter=str.begin()+pos;
+   return nextToken();
+  } 
+ }
+ 
+ string::size_type pos=str.find_first_of("\n\r\t()
,", iter-str.begin());
  if (pos==string::npos) {
-  if (str.size()>0) {
-   tok=str.substr(0);
-   str="";
+  if (iter!=str.end()) {
+   tok.assign(iter,str.end());
+   iter=str.end();
   } else {
    return StringTokenizer::TT_EOF;
   }
  } else {
-  tok=str.substr(0,pos);
-  str=str.substr(pos);
+  tok.assign(iter,str.begin()+pos);
+  iter=str.begin()+pos;
  }
- char *stopstring;
+ char* stopstring;
  double dbl=strtod(tok.c_str(),&stopstring);
- if (strcmp(stopstring,"")==0) {
+ if (*stopstring=='\0') {
   ntok=dbl;
   stok="";
   return StringTokenizer::TT_NUMBER;
@@ -102,35 +100,35 @@
  }
 }
 
-int StringTokenizer::peekNextToken(){
+int StringTokenizer::peekNextToken() {
  string::size_type pos;
  string tok="";
- if (str.size()==0)
+ if (iter==str.end())
+  return StringTokenizer::TT_EOF;
+ 
+ pos=str.find_first_not_of("
\r\n\t",iter-str.begin());
+ if (pos==string::npos) 
   return StringTokenizer::TT_EOF;
-
- pos=str.find_first_not_of(" \r\n\t");
- if (pos==string::npos) return
StringTokenizer::TT_EOF;
  switch(str[pos]) {
   case '(':
-   return '(';
   case ')':
-   return ')';
   case ',':
-   return ',';
+   return str[pos];
  }
- pos=str.find_first_of("\n\r\t() ,");
+
+ pos=str.find_first_of("\n\r\t()
,",iter-str.begin());
  if (pos==string::npos) {
-  if (str.size()>0) {
-   tok=str.substr(0);
+  if (iter!=str.end()) {
+   tok.assign(iter,str.end());
   } else {
    return StringTokenizer::TT_EOF;
   }
  } else {
-  tok=str.substr(0,pos);
+  tok.assign(iter,str.end());
  }
  char *stopstring;
  double dbl=strtod(tok.c_str(),&stopstring);
- if (strcmp(stopstring,"")==0) {
+ if (*stopstring=='\0') {
   ntok=dbl;
   stok="";
   return StringTokenizer::TT_NUMBER;
Index: source/io/WKTReader.cpp
===================================================================
RCS file:
/home/cvs/postgis/geos/source/io/WKTReader.cpp,v
retrieving revision 1.30
diff -u -r1.30 WKTReader.cpp
--- source/io/WKTReader.cpp 8 Dec 2004 13:54:43 -0000
1.30
+++ source/io/WKTReader.cpp 14 Apr 2005 09:16:42 -0000
@@ -33,7 +33,7 @@
  //delete geometryFactory;
 }
 
-Geometry* WKTReader::read(string wellKnownText){
+Geometry* WKTReader::read(const string&
wellKnownText){
  auto_ptr<StringTokenizer> tokenizer(new
StringTokenizer(wellKnownText));
  StringTokenizer *st=tokenizer.release();
  Geometry *g=NULL;


_________________________________________________________
Do You Yahoo!?
150ÕÚ«˙MP3∑ËøÒÀ—£¨¥¯ƒ˙¥≥»Î“Ù¿÷µÓÃ√
http://cn.rd.yahoo.com/mail_cn/tag/yisou/music/*http://music.yisou.com/
√¿≈Æ√˜–«”¶”–æ°”–£¨À—±È√¿Õº°¢—ﬁÕº∫Õø·Õº
http://cn.rd.yahoo.com/mail_cn/tag/yisou/image/*http://image.yisou.com
1GæÕ «1000’◊£¨—≈ª¢µÁ” ◊‘÷˙¿©»›£°
http://cn.rd.yahoo.com/mail_cn/tag/1g/*http://cn.mail.yahoo.com/event/mail_1g/

From strk at refractions.net  Thu Apr 14 07:47:30 2005
From: strk at refractions.net (strk@refractions.net)
Date: Fri Nov  2 20:52:40 2007
Subject: [geos-devel] Performance enhance in Parsing WKT data
In-Reply-To: <20050414102317.62698.qmail@web15010.mail.cnb.yahoo.com>
References: <20050414102317.62698.qmail@web15010.mail.cnb.yahoo.com>
Message-ID: <20050414114730.GC30553@freek.keybit.net>

Thank a lot Cheng!
I've applied your patch with a minor modification
(removed the default constructor of StringTokenizer
so it fully works with a reference and makes no
copies at all.

If you have tests handy, please run them.
Thanks
--strk;

On Thu, Apr 14, 2005 at 06:23:17PM +0800, Cheng Shan wrote:
> Hello,
>     These days I have been using GEOS to parse WKT
> format data. And I found that the performance decreace
> dramatically when loading big geometry. For my result,
> it takes 24~30 second to load 337 geometry. But it
> needs only about 2~3 second when using JTS. I suspect
> there are somethings wrong.
>     After about two days study, I found that the class
> "StringTokenizer" allocate and deallocate memory
> frequently.
> So I made some modification on the class. Now it takes
> 3~4 second to load the same data. And the tests passed
> without any problem.
>     Also I modify the type of the function
> WKTReader::read's parameter "wellKnownText" from
> "string" to "const string&", this can avoid the copy
> of the argument.
>     Maybe the work is useful. And I would like to
> share it with all people who use the project GEOS. The
> following is the difference list:
> ? build
> Index: source/headers/geos/io.h
> ===================================================================
> RCS file:
> /home/cvs/postgis/geos/source/headers/geos/io.h,v
> retrieving revision 1.5
> diff -u -r1.5 io.h
> --- source/headers/geos/io.h 19 Jul 2004 10:33:12
> -0000 1.5
> +++ source/headers/geos/io.h 14 Apr 2005 09:16:40
> -0000
> @@ -92,16 +92,17 @@
>    TT_WORD
>   };
>   StringTokenizer();
> - StringTokenizer(string txt);
> + StringTokenizer(const string& txt);
>   ~StringTokenizer();
>   int nextToken();
>   int peekNextToken();
>   double getNVal();
>   string getSVal();
>  private:
> - string str;
> + const string str;
>   string stok;
>   double ntok;
> + string::const_iterator iter;
>  };
>  
>  /**
> @@ -125,7 +126,7 @@
>   ~WKTReader();
>  
>   /// Parse a WKT string returning a Geometry
> - Geometry* read(string wellKnownText);
> + Geometry* read(const string& wellKnownText);
>  
>  // Geometry* read(Reader reader); //Not implemented
> yet
>  
> Index: source/io/StringTokenizer.cpp
> ===================================================================
> RCS file:
> /home/cvs/postgis/geos/source/io/StringTokenizer.cpp,v
> retrieving revision 1.11
> diff -u -r1.11 StringTokenizer.cpp
> --- source/io/StringTokenizer.cpp 2 Jul 2004 13:28:27
> -0000 1.11
> +++ source/io/StringTokenizer.cpp 14 Apr 2005 09:16:42
> -0000
> @@ -39,59 +39,57 @@
>  
>  namespace geos {
>  
> -StringTokenizer::StringTokenizer(){
> - str="";
> +StringTokenizer::StringTokenizer()
> + :str("") {
>   stok="";
>   ntok=0.0;
> + iter=str.begin();
>  }
> -StringTokenizer::StringTokenizer(string txt) {
> - str=txt;
> +StringTokenizer::StringTokenizer(const string& txt)
> + : str(txt) {
>   stok="";
>   ntok=0.0;
> + iter=str.begin();
>  }
>  StringTokenizer::~StringTokenizer(){}
>  
> -int StringTokenizer::nextToken(){
> +int StringTokenizer::nextToken() {
>   string tok="";
> - if (str.size()==0)
> + if (iter==str.end())
>    return StringTokenizer::TT_EOF;
> - switch(str[0]) {
> -  case '(':
> -   str=str.substr(1);
> -   return '(';
> -  case ')':
> -   str=str.substr(1);
> -   return ')';
> -  case ',':
> -   str=str.substr(1);
> -   return ',';
> -  case '\n':
> -  case '\r':
> -  case '\t':
> -  case ' ':
> -   string::size_type pos=str.find_first_not_of("
> \n\r\t");
> -   if (pos==string::npos) {
> -    return StringTokenizer::TT_EOF;
> -   } else {
> -    str=str.substr(pos);
> -    return nextToken();
> -   }
> -  }
> - string::size_type pos=str.find_first_of("\n\r\t()
> ,");
> + switch (*iter) {
> + case '(':
> + case ')':
> + case ',':
> +  return *iter++;
> + case '\n':
> + case '\r':
> + case '\t':
> + case ' ':
> +  string::size_type pos=str.find_first_not_of("
> \n\r\t",iter-str.begin());
> +  if (pos==string::npos) {
> +   return StringTokenizer::TT_EOF;
> +  } else {
> +   iter=str.begin()+pos;
> +   return nextToken();
> +  } 
> + }
> + 
> + string::size_type pos=str.find_first_of("\n\r\t()
> ,", iter-str.begin());
>   if (pos==string::npos) {
> -  if (str.size()>0) {
> -   tok=str.substr(0);
> -   str="";
> +  if (iter!=str.end()) {
> +   tok.assign(iter,str.end());
> +   iter=str.end();
>    } else {
>     return StringTokenizer::TT_EOF;
>    }
>   } else {
> -  tok=str.substr(0,pos);
> -  str=str.substr(pos);
> +  tok.assign(iter,str.begin()+pos);
> +  iter=str.begin()+pos;
>   }
> - char *stopstring;
> + char* stopstring;
>   double dbl=strtod(tok.c_str(),&stopstring);
> - if (strcmp(stopstring,"")==0) {
> + if (*stopstring=='\0') {
>    ntok=dbl;
>    stok="";
>    return StringTokenizer::TT_NUMBER;
> @@ -102,35 +100,35 @@
>   }
>  }
>  
> -int StringTokenizer::peekNextToken(){
> +int StringTokenizer::peekNextToken() {
>   string::size_type pos;
>   string tok="";
> - if (str.size()==0)
> + if (iter==str.end())
> +  return StringTokenizer::TT_EOF;
> + 
> + pos=str.find_first_not_of("
> \r\n\t",iter-str.begin());
> + if (pos==string::npos) 
>    return StringTokenizer::TT_EOF;
> -
> - pos=str.find_first_not_of(" \r\n\t");
> - if (pos==string::npos) return
> StringTokenizer::TT_EOF;
>   switch(str[pos]) {
>    case '(':
> -   return '(';
>    case ')':
> -   return ')';
>    case ',':
> -   return ',';
> +   return str[pos];
>   }
> - pos=str.find_first_of("\n\r\t() ,");
> +
> + pos=str.find_first_of("\n\r\t()
> ,",iter-str.begin());
>   if (pos==string::npos) {
> -  if (str.size()>0) {
> -   tok=str.substr(0);
> +  if (iter!=str.end()) {
> +   tok.assign(iter,str.end());
>    } else {
>     return StringTokenizer::TT_EOF;
>    }
>   } else {
> -  tok=str.substr(0,pos);
> +  tok.assign(iter,str.end());
>   }
>   char *stopstring;
>   double dbl=strtod(tok.c_str(),&stopstring);
> - if (strcmp(stopstring,"")==0) {
> + if (*stopstring=='\0') {
>    ntok=dbl;
>    stok="";
>    return StringTokenizer::TT_NUMBER;
> Index: source/io/WKTReader.cpp
> ===================================================================
> RCS file:
> /home/cvs/postgis/geos/source/io/WKTReader.cpp,v
> retrieving revision 1.30
> diff -u -r1.30 WKTReader.cpp
> --- source/io/WKTReader.cpp 8 Dec 2004 13:54:43 -0000
> 1.30
> +++ source/io/WKTReader.cpp 14 Apr 2005 09:16:42 -0000
> @@ -33,7 +33,7 @@
>   //delete geometryFactory;
>  }
>  
> -Geometry* WKTReader::read(string wellKnownText){
> +Geometry* WKTReader::read(const string&
> wellKnownText){
>   auto_ptr<StringTokenizer> tokenizer(new
> StringTokenizer(wellKnownText));
>   StringTokenizer *st=tokenizer.release();
>   Geometry *g=NULL;
> 
> 
> _________________________________________________________
> Do You Yahoo!?
> 150????MP3????????????????????????
> http://cn.rd.yahoo.com/mail_cn/tag/yisou/music/*http://music.yisou.com/
> ??????????????????????????????????????
> http://cn.rd.yahoo.com/mail_cn/tag/yisou/image/*http://image.yisou.com
> 1G????1000??????????????????????
> http://cn.rd.yahoo.com/mail_cn/tag/1g/*http://cn.mail.yahoo.com/event/mail_1g/
> _______________________________________________
> geos-devel mailing list
> geos-devel@geos.refractions.net
> http://geos.refractions.net/mailman/listinfo/geos-devel

From fwarmerdam at gmail.com  Mon Apr 18 11:16:45 2005
From: fwarmerdam at gmail.com (Frank Warmerdam)
Date: Fri Nov  2 20:52:40 2007
Subject: [geos-devel] GEOS Exceptions
Message-ID: <931f8ea90504180816360bfa38@mail.gmail.com>

Folks,

I must confess I am not a particular advanced C++ programmer.  I
tend to avoid use of C++ exceptions, so now I find myself in a situation
where I am not quite sure what to do. 

I have the following code to parse a WKT string into a
geos geometry. 

    try 
    { 
        geos::Geometry *geosGeometry = NULL;
        geosGeometry = geosWktReader.read( oWKT );
        return geosGeometry;
    }
    catch( geos::GEOSException &e )
    {
        CPLError( CE_Failure, CPLE_AppDefined,
                  "GEOSException: %s", 
                  e.toString().c_str() );

        return NULL;
    }

The WKT in this case is invalid (a two point polygon) that looks
like this:

POLYGON ((428909.103 4756578.350,681115.834 4980288.650))

Geos seems to throw an exception, but my catch does not seem 
to be catching it.  I skimmed through the WKTReader code, and 
I see it mostly throws ParseExceptions which are derived from
GEOSException.  However, I suspect the exception that really
gets thrown is at a lower validation level. 

Is anyone aware of exceptions that GEOS might throw in this
case that are not derived from geos::GEOSException?  

Should my try/catch block catch all geos exceptions properly? 

Does anyone know an easy way to break in any exception
as it is thrown in gdb? 

Best regards,
-- 
---------------------------------------+--------------------------------------
I set the clouds in motion - turn up   | Frank Warmerdam, warmerdam@pobox.com
light and sound - activate the windows | http://pobox.com/~warmerdam
and watch the world go round - Rush    | Geospatial Programmer for Rent

From niki.spahiev at gmail.com  Mon Apr 18 11:29:10 2005
From: niki.spahiev at gmail.com (Niki Spahiev)
Date: Fri Nov  2 20:52:40 2007
Subject: [geos-devel] GEOS Exceptions
In-Reply-To: <931f8ea90504180816360bfa38@mail.gmail.com>
References: <931f8ea90504180816360bfa38@mail.gmail.com>
Message-ID: <67c22932050418082966c86649@mail.gmail.com>

You has to catch by pointer and then delete exception

catch( geos::GEOSException * e ) {
    ....
    delete e;
}

HTH
Niki Spahiev

From nhv at cape.com  Mon Apr 18 11:36:27 2005
From: nhv at cape.com (Norman Vine)
Date: Fri Nov  2 20:52:40 2007
Subject: [geos-devel] GEOS Exceptions
In-Reply-To: <931f8ea90504180816360bfa38@mail.gmail.com>
Message-ID: <EKEJIKAILPONGGENMBGAKEHGLCAA.nhv@cape.com>

Frank Warmerdam writes:
> 
> I have the following code to parse a WKT string into a
> geos geometry. 
> 
>     try 
>     { 
>         geos::Geometry *geosGeometry = NULL;
>         geosGeometry = geosWktReader.read( oWKT );
>         return geosGeometry;
>     }
>     catch( geos::GEOSException &e )
>     {
>         CPLError( CE_Failure, CPLE_AppDefined,
>                   "GEOSException: %s", 
>                   e.toString().c_str() );
> 
>         return NULL;
>     }

Maybe

     catch( geos::GEOSException *e )
     {
         CPLError( CE_Failure, CPLE_AppDefined,
                  "GEOSException: %s", 
                  (char *)ge->toString().c_str() );

        return NULL;
    }
 
HTH

Norman

From strk at refractions.net  Mon Apr 18 11:34:11 2005
From: strk at refractions.net (strk@refractions.net)
Date: Fri Nov  2 20:52:40 2007
Subject: [geos-devel] GEOS Exceptions
In-Reply-To: <931f8ea90504180816360bfa38@mail.gmail.com>
References: <931f8ea90504180816360bfa38@mail.gmail.com>
Message-ID: <20050418153411.GB74100@freek.keybit.net>

On Mon, Apr 18, 2005 at 11:16:45AM -0400, Frank Warmerdam wrote:
> Folks,
> 
> I must confess I am not a particular advanced C++ programmer.  I
> tend to avoid use of C++ exceptions, so now I find myself in a situation
> where I am not quite sure what to do. 

I really think this is a GEOS bug, in that it throws by pointer
instead of by reference.
I'm somehow happy to know you faced this so maybe you'll support a
switch to a throw-by-reference-of-std::exception-derived, altought
it will be a big API break.

--strk;

> 
> I have the following code to parse a WKT string into a
> geos geometry. 
> 
>     try 
>     { 
>         geos::Geometry *geosGeometry = NULL;
>         geosGeometry = geosWktReader.read( oWKT );
>         return geosGeometry;
>     }
>     catch( geos::GEOSException &e )
>     {
>         CPLError( CE_Failure, CPLE_AppDefined,
>                   "GEOSException: %s", 
>                   e.toString().c_str() );
> 
>         return NULL;
>     }
> 
> The WKT in this case is invalid (a two point polygon) that looks
> like this:
> 
> POLYGON ((428909.103 4756578.350,681115.834 4980288.650))
> 
> Geos seems to throw an exception, but my catch does not seem 
> to be catching it.  I skimmed through the WKTReader code, and 
> I see it mostly throws ParseExceptions which are derived from
> GEOSException.  However, I suspect the exception that really
> gets thrown is at a lower validation level. 
> 
> Is anyone aware of exceptions that GEOS might throw in this
> case that are not derived from geos::GEOSException?  
> 
> Should my try/catch block catch all geos exceptions properly? 
> 
> Does anyone know an easy way to break in any exception
> as it is thrown in gdb? 
> 
> Best regards,
> -- 
> ---------------------------------------+--------------------------------------
> I set the clouds in motion - turn up   | Frank Warmerdam, warmerdam@pobox.com
> light and sound - activate the windows | http://pobox.com/~warmerdam
> and watch the world go round - Rush    | Geospatial Programmer for Rent
> _______________________________________________
> geos-devel mailing list
> geos-devel@geos.refractions.net
> http://geos.refractions.net/mailman/listinfo/geos-devel

From fwarmerdam at gmail.com  Mon Apr 18 11:46:00 2005
From: fwarmerdam at gmail.com (Frank Warmerdam)
Date: Fri Nov  2 20:52:41 2007
Subject: [geos-devel] GEOS Exceptions
In-Reply-To: <20050418153411.GB74100@freek.keybit.net>
References: <931f8ea90504180816360bfa38@mail.gmail.com>
	<20050418153411.GB74100@freek.keybit.net>
Message-ID: <931f8ea905041808465b85ada5@mail.gmail.com>

On 4/18/05, strk@refractions.net <strk@refractions.net> wrote:
> On Mon, Apr 18, 2005 at 11:16:45AM -0400, Frank Warmerdam wrote:
> > Folks,
> >
> > I must confess I am not a particular advanced C++ programmer.  I
> > tend to avoid use of C++ exceptions, so now I find myself in a situation
> > where I am not quite sure what to do.
> 
> I really think this is a GEOS bug, in that it throws by pointer
> instead of by reference.
> I'm somehow happy to know you faced this so maybe you'll support a
> switch to a throw-by-reference-of-std::exception-derived, altought
> it will be a big API break.

Niki / Norman --- thanks the change fixed up my problem. 

Strk,

I certainly don't know how bad a practice throwing exceptions
by pointer is, but I am quite adverse to such changes like this
that require every application using GEOS to be changed.  It is
churn like this that poisons folks against using a library.   If you are
going to make the change, I think you should go a bit further and
rename the exception class to ensure that folks can't compile
with the new version till they revisit this area, though even that won't
ensure they know the new expected calling conventions.  In fact, 
I would suggest just putting this on a "todo list" for the next major
compatibility break - even if that is a long ways in the future. 

Best regards,
-- 
---------------------------------------+--------------------------------------
I set the clouds in motion - turn up   | Frank Warmerdam, warmerdam@pobox.com
light and sound - activate the windows | http://pobox.com/~warmerdam
and watch the world go round - Rush    | Geospatial Programmer for Rent

From mcoletti at gmail.com  Mon Apr 18 13:09:06 2005
From: mcoletti at gmail.com (Mark Coletti)
Date: Fri Nov  2 20:52:41 2007
Subject: [geos-devel] GEOS Exceptions
In-Reply-To: <20050418153411.GB74100@freek.keybit.net>
References: <931f8ea90504180816360bfa38@mail.gmail.com>
	<20050418153411.GB74100@freek.keybit.net>
Message-ID: <1200950805041810094393d592@mail.gmail.com>

On 4/18/05, strk@refractions.net <strk@refractions.net> wrote:
> On Mon, Apr 18, 2005 at 11:16:45AM -0400, Frank Warmerdam wrote:
> > Folks,
> >
> > I must confess I am not a particular advanced C++ programmer.  I
> > tend to avoid use of C++ exceptions, so now I find myself in a situation
> > where I am not quite sure what to do.
> 
> I really think this is a GEOS bug, in that it throws by pointer
> instead of by reference.
> I'm somehow happy to know you faced this so maybe you'll support a
> switch to a throw-by-reference-of-std::exception-derived, altought
> it will be a big API break.

strk, didn't we have correspondence a while ago about this very issue?  I think
I supplied you with patches that would not only fix the
throw-by-reference-of-std::exception-derived implementation, but
patched the
dependent areas of the code.

Cheers!

MAC
-- 
I'm taking reality in small doses to build immunity.

From mcoletti at gmail.com  Mon Apr 18 13:10:57 2005
From: mcoletti at gmail.com (Mark Coletti)
Date: Fri Nov  2 20:52:41 2007
Subject: [geos-devel] GEOS Exceptions
In-Reply-To: <EKEJIKAILPONGGENMBGAKEHGLCAA.nhv@cape.com>
References: <931f8ea90504180816360bfa38@mail.gmail.com>
	<EKEJIKAILPONGGENMBGAKEHGLCAA.nhv@cape.com>
Message-ID: <12009508050418101014ee491@mail.gmail.com>

On 4/18/05, Norman Vine <nhv@cape.com> wrote:
> 
>      catch( geos::GEOSException *e )
>      {
>          CPLError( CE_Failure, CPLE_AppDefined,
>                   "GEOSException: %s",
>                   (char *)ge->toString().c_str() );
> 
>         return NULL;
>     }

Need to free the exception before returning.  (As another reader pointed out.)

      catch( geos::GEOSException *e )
      {
          CPLError( CE_Failure, CPLE_AppDefined,
                   "GEOSException: %s",
                   (char *)ge->toString().c_str() );

         delete e;
 
         return NULL;
     }

-- 
I'm taking reality in small doses to build immunity.

From strk at refractions.net  Mon Apr 18 13:11:48 2005
From: strk at refractions.net (strk@refractions.net)
Date: Fri Nov  2 20:52:41 2007
Subject: [geos-devel] GEOS Exceptions
In-Reply-To: <1200950805041810094393d592@mail.gmail.com>
References: <931f8ea90504180816360bfa38@mail.gmail.com>
	<20050418153411.GB74100@freek.keybit.net>
	<1200950805041810094393d592@mail.gmail.com>
Message-ID: <20050418171148.GC75408@freek.keybit.net>

On Mon, Apr 18, 2005 at 01:09:06PM -0400, Mark Coletti wrote:
> On 4/18/05, strk@refractions.net <strk@refractions.net> wrote:
> > On Mon, Apr 18, 2005 at 11:16:45AM -0400, Frank Warmerdam wrote:
> > > Folks,
> > >
> > > I must confess I am not a particular advanced C++ programmer.  I
> > > tend to avoid use of C++ exceptions, so now I find myself in a situation
> > > where I am not quite sure what to do.
> > 
> > I really think this is a GEOS bug, in that it throws by pointer
> > instead of by reference.
> > I'm somehow happy to know you faced this so maybe you'll support a
> > switch to a throw-by-reference-of-std::exception-derived, altought
> > it will be a big API break.
> 
> strk, didn't we have correspondence a while ago about this very issue?  I think
> I supplied you with patches that would not only fix the
> throw-by-reference-of-std::exception-derived implementation, but
> patched the
> dependent areas of the code.

We surely did, and I didn't apply them to avoid breaking the API.
I hope they'll cleanly apply when we finally decide to do the break.
(dependent areas are all client applications!)
--strk;

> 
> Cheers!
> 
> MAC
> -- 
> I'm taking reality in small doses to build immunity.
> _______________________________________________
> geos-devel mailing list
> geos-devel@geos.refractions.net
> http://geos.refractions.net/mailman/listinfo/geos-devel

From mcoletti at gmail.com  Mon Apr 18 13:15:38 2005
From: mcoletti at gmail.com (Mark Coletti)
Date: Fri Nov  2 20:52:41 2007
Subject: [geos-devel] GEOS Exceptions
In-Reply-To: <20050418171148.GC75408@freek.keybit.net>
References: <931f8ea90504180816360bfa38@mail.gmail.com>
	<20050418153411.GB74100@freek.keybit.net>
	<1200950805041810094393d592@mail.gmail.com>
	<20050418171148.GC75408@freek.keybit.net>
Message-ID: <12009508050418101561a69a95@mail.gmail.com>

On 4/18/05, strk@refractions.net <strk@refractions.net> wrote:
> We surely did, and I didn't apply them to avoid breaking the API.
> I hope they'll cleanly apply when we finally decide to do the break.
> (dependent areas are all client applications!)

Yabut it's easy to compensate for the change; moreover the longer you
wait before effecting these changes, the more painful it will be for
you and GEOS clients.  Obviously my patches will degrade over time as
GEOS evolves; and over time there will be more GEOS users thus
increasing the API change impact.

I'm just sayin'.  8-)

Cheers!

MAC
-- 
I'm taking reality in small doses to build immunity.

From artem at pavlenko.uklinux.net  Mon Apr 18 14:47:52 2005
From: artem at pavlenko.uklinux.net (Artem Pavlenko)
Date: Fri Nov  2 20:52:41 2007
Subject: [geos-devel] GEOS Exceptions
In-Reply-To: <20050418171148.GC75408@freek.keybit.net>
References: <931f8ea90504180816360bfa38@mail.gmail.com>	<20050418153411.GB74100@freek.keybit.net>	<1200950805041810094393d592@mail.gmail.com>
	<20050418171148.GC75408@freek.keybit.net>
Message-ID: <426400D8.40001@pavlenko.uklinux.net>

strk@refractions.net wrote:

>On Mon, Apr 18, 2005 at 01:09:06PM -0400, Mark Coletti wrote:
>  
>
>>On 4/18/05, strk@refractions.net <strk@refractions.net> wrote:
>>    
>>
>>>On Mon, Apr 18, 2005 at 11:16:45AM -0400, Frank Warmerdam wrote:
>>>      
>>>
>>>>Folks,
>>>>
>>>>I must confess I am not a particular advanced C++ programmer.  I
>>>>tend to avoid use of C++ exceptions, so now I find myself in a situation
>>>>where I am not quite sure what to do.
>>>>        
>>>>
>>>I really think this is a GEOS bug, in that it throws by pointer
>>>instead of by reference.
>>>I'm somehow happy to know you faced this so maybe you'll support a
>>>switch to a throw-by-reference-of-std::exception-derived, altought
>>>it will be a big API break.
>>>      
>>>
>>strk, didn't we have correspondence a while ago about this very issue?  I think
>>I supplied you with patches that would not only fix the
>>throw-by-reference-of-std::exception-derived implementation, but
>>patched the
>>dependent areas of the code.
>>    
>>
>
>We surely did, and I didn't apply them to avoid breaking the API.
>I hope they'll cleanly apply when we finally decide to do the break.
>(dependent areas are all client applications!)
>--strk;
>
>  
>
Hello, just to add my voice of support to Mark's comments. GEOS is long 
due for improvements IMHO.
Yes, in c++ you throw by value and catch by reference.
Yes, you can also throw by value and pointer and it is not a 'bug', but 
this is not good practice.
Yes these changes will require clients to add small modifications and 
re-compile, but I reckon there are lots of potential users out there who 
don't consider GEOS precisely because of 'bugs' like this.

The Open source community deserves something better then MFC, doesn't it?

These changes are trivial and must be applied now. This would give 
potential users confidence and speed up wider adoption of GEOS.

btw, I've done some work on WKT parser for my project (based on 
boost::spirit) and I'd like to share with GEOS if anyone is interested. 
I think it is a somewhat cleaner solution for the task.

Cheers!
Artem Pavlenko


From mcoletti at gmail.com  Mon Apr 18 16:31:54 2005
From: mcoletti at gmail.com (Mark Coletti)
Date: Fri Nov  2 20:52:41 2007
Subject: [geos-devel] GEOS Exceptions
In-Reply-To: <426400D8.40001@pavlenko.uklinux.net>
References: <931f8ea90504180816360bfa38@mail.gmail.com>
	<20050418153411.GB74100@freek.keybit.net>
	<1200950805041810094393d592@mail.gmail.com>
	<20050418171148.GC75408@freek.keybit.net>
	<426400D8.40001@pavlenko.uklinux.net>
Message-ID: <1200950805041813317b7d5a4d@mail.gmail.com>

On 4/18/05, Artem Pavlenko <artem@pavlenko.uklinux.net> wrote:

[...]

> Yes these changes will require clients to add small modifications and
> re-compile, but I reckon there are lots of potential users out there who
> don't consider GEOS precisely because of 'bugs' like this.

The exceptions thing isn't too egregious.  I don't think it's a deal
breaker with regards to deciding to use GEOS.  I'm guessing that many
users are unaware of the exception interface until one happens to get
thrown.  (Which looks like may have happened to Frank.  It's certainly
what happened to me.  And my efforts were more to get more useful
debugging information than improving GEOS design and implementation. 
Inheriting from std::exception provided a bit more debugging
information.)

> The Open source community deserves something better then MFC, doesn't it?

What does MFC have to do with GEOS?  

Actually, does anyone use MFC?   (On purpose?)

> These changes are trivial and must be applied now. This would give
> potential users confidence and speed up wider adoption of GEOS.

Again, though I urged making the aforementioned changes sooner than
later for pragmatic reasons, the exception interface isn't bad enough
to scare off people, especially given that most  probably won't notice
the exceptions until they're thrown.  (And then, sadly, most of them
might not know why throwing pointers to exception objects is a badism
and that there even exists an exception class hierarchy in the ISO
Standard C++ Library.)  GEOS happens to fill a much needed niche for a
C++ geospatial library; some might be so happy that one even exists
that they might not pay attention to the details.

Of course this is all just empty speculation.
 
> btw, I've done some work on WKT parser for my project (based on
> boost::spirit) and I'd like to share with GEOS if anyone is interested.
> I think it is a somewhat cleaner solution for the task.

I've looked at the Boost Spirit parser before and thought it was a
neat idea.  I thought it would be a great way to implement a WKT
parser.  You'd probably get some performance boost.  (No pun
intended!)  At the very least the code should (hopefully) be easier to
read, understand, and maintain.  Have you done any empirical
measurement to note any significant performance differences between
the old and new parsers?


Cheers,

MAC
-- 
I'm taking reality in small doses to build immunity.

From artem at pavlenko.uklinux.net  Mon Apr 18 17:13:55 2005
From: artem at pavlenko.uklinux.net (Artem Pavlenko)
Date: Fri Nov  2 20:52:41 2007
Subject: [geos-devel] GEOS Exceptions
In-Reply-To: <1200950805041813317b7d5a4d@mail.gmail.com>
References: <931f8ea90504180816360bfa38@mail.gmail.com>	<20050418153411.GB74100@freek.keybit.net>	<1200950805041810094393d592@mail.gmail.com>	<20050418171148.GC75408@freek.keybit.net>	<426400D8.40001@pavlenko.uklinux.net>
	<1200950805041813317b7d5a4d@mail.gmail.com>
Message-ID: <42642313.3080709@pavlenko.uklinux.net>


>The exceptions thing isn't too egregious.  I don't think it's a deal
>breaker with regards to deciding to use GEOS.  I'm guessing that many
>users are unaware of the exception interface until one happens to get
>thrown.  (Which looks like may have happened to Frank.  It's certainly
>what happened to me.  And my efforts were more to get more useful
>debugging information than improving GEOS design and implementation. 
>Inheriting from std::exception provided a bit more debugging
>information.)
>
I see GEOS as a development platform used by developers, and 'c++ style' 
currently at large would certainly raise concerns among many  (IMHO). 
Exceptions are just one example.

>What does MFC have to do with GEOS?  
>  
>
MFC is (was?) (in)famously throwing exceptions by pointer, AFAIK :)
(pre standard C++) - I was joking :(

>Actually, does anyone use MFC?   (On purpose?)
>  
>

I hope not

>
>Again, though I urged making the aforementioned changes sooner than
>later for pragmatic reasons, the exception interface isn't bad enough
>to scare off people, especially given that most  probably won't notice
>the exceptions until they're thrown.  (And then, sadly, most of them
>might not know why throwing pointers to exception objects is a badism
>and that there even exists an exception class hierarchy in the ISO
>Standard C++ Library.) 
>

> GEOS happens to fill a much needed niche for a
>C++ geospatial library; some might be so happy that one even exists
>that they might not pay attention to the details.
>  
>
Yes, of course, but we should have 'the best' as free software often is 
in many other areas.

>
>I've looked at the Boost Spirit parser before and thought it was a
>neat idea.  I thought it would be a great way to implement a WKT
>parser.  You'd probably get some performance boost.  (No pun
>intended!)  At the very least the code should (hopefully) be easier to
>read, understand, and maintain.
>
>  Have you done any empirical
>measurement to note any significant performance differences between
>the old and new parsers?
>
>  
>
Nope, but I will at some point. Are there any test WKT datasets I could 
try? Also I load WKT into my geometry model which is different from GEOS. 

Also proper grammar based approach can be a winner for CS WKT?

Cheers
Artem


From tmacy at mapshots.com  Mon Apr 18 17:28:33 2005
From: tmacy at mapshots.com (Ted Macy)
Date: Fri Nov  2 20:52:41 2007
Subject: [geos-devel] GEOS Exceptions
In-Reply-To: <42642313.3080709@pavlenko.uklinux.net>
Message-ID: <200504181725109.SM02020@mobiledog>

I use WKT extensively in my applications... that is what we store in our
database for thousands of acres worth of detail agronomy records, so I am
VERY interested in the WKT parser performance.  I will be happy to generate
some files of WKT data, if it would help.  Drop me a note directly and let
me know what you would like.   Something like the boundaries of every county
in every state, or GPS collected field boundaries at 1 second resolution for
thousands of acres?   

>  Have you done any empirical
>measurement to note any significant performance differences between
>the old and new parsers?
>
>  
>
Nope, but I will at some point. Are there any test WKT datasets I could 
try? Also I load WKT into my geometry model which is different from GEOS. 




From strk at refractions.net  Mon Apr 18 19:18:49 2005
From: strk at refractions.net (strk@refractions.net)
Date: Fri Nov  2 20:52:41 2007
Subject: [geos-devel] GEOS Exceptions
In-Reply-To: <1200950805041813317b7d5a4d@mail.gmail.com>
References: <931f8ea90504180816360bfa38@mail.gmail.com>
	<20050418153411.GB74100@freek.keybit.net>
	<1200950805041810094393d592@mail.gmail.com>
	<20050418171148.GC75408@freek.keybit.net>
	<426400D8.40001@pavlenko.uklinux.net>
	<1200950805041813317b7d5a4d@mail.gmail.com>
Message-ID: <20050418231848.GA76581@freek.keybit.net>

On Mon, Apr 18, 2005 at 04:31:54PM -0400, Mark Coletti wrote:
> On 4/18/05, Artem Pavlenko <artem@pavlenko.uklinux.net> wrote:
...
> > btw, I've done some work on WKT parser for my project (based on
> > boost::spirit) and I'd like to share with GEOS if anyone is interested.
> > I think it is a somewhat cleaner solution for the task.
> 
> I've looked at the Boost Spirit parser before and thought it was a
> neat idea.  I thought it would be a great way to implement a WKT
> parser.  You'd probably get some performance boost.  (No pun
> intended!)  At the very least the code should (hopefully) be easier to
> read, understand, and maintain.  Have you done any empirical
> measurement to note any significant performance differences between
> the old and new parsers?

If you're going to make comparison please do it against current
CVS as the WKT parser has been improved.
--strk;

> 
> 
> Cheers,
> 
> MAC
> -- 
> I'm taking reality in small doses to build immunity.
> _______________________________________________
> geos-devel mailing list
> geos-devel@geos.refractions.net
> http://geos.refractions.net/mailman/listinfo/geos-devel

From artem at pavlenko.uklinux.net  Tue Apr 19 06:39:19 2005
From: artem at pavlenko.uklinux.net (Artem Pavlenko)
Date: Fri Nov  2 20:52:41 2007
Subject: [geos-devel] GEOS Exceptions
In-Reply-To: <20050418231848.GA76581@freek.keybit.net>
References: <931f8ea90504180816360bfa38@mail.gmail.com>	<20050418153411.GB74100@freek.keybit.net>	<1200950805041810094393d592@mail.gmail.com>	<20050418171148.GC75408@freek.keybit.net>	<426400D8.40001@pavlenko.uklinux.net>	<1200950805041813317b7d5a4d@mail.gmail.com>
	<20050418231848.GA76581@freek.keybit.net>
Message-ID: <4264DFD7.5090804@pavlenko.uklinux.net>

Hi strk,
I've coded a couple of tests:

data =  usa counties WKT 84Mb  3140 MULTIPOLYGONS (created like shp -> 
postgis -> wkt)
 
1.  GEOS  WKT  reader
     real    0m24.642s
     user    0m24.374s
     sys     0m0.235s

2. Mapnik WKT Reader
    real    0m15.651s
    user    0m15.215s
    sys     0m0.223s

It is not completely fair test, but shows that boost::spirit is fit the job.
Also new approach requires boost::spirit headers ( no libs ) and you get 
increase in compile time.
But, it is more elegant then 'StringTokenizer', easier to maintain (you 
can add more grammar later) and can be optimized even more.

What do you reckon? I can send you my test files?
How is GEOS development process organised?

Also, I've noticed that GEOS  using incorrect WKT grammar IMHO  e.g
POINT(EMPTY)????

OpenGIS Simple Features Specification rev1.1 EBNF:

<Point Text> := EMPTY | (<Point>)

According to ISO/IEC 14977 'EMPTY' means literally empty as far as I 
understand,
and valid WKT for point geometry: POINT  or POINT (x y)
The same applies to the rest.

Have you looked into that? Am i missing something?

Cheers!

Artem

 



From strk at refractions.net  Tue Apr 19 07:29:11 2005
From: strk at refractions.net (strk@refractions.net)
Date: Fri Nov  2 20:52:41 2007
Subject: [geos-devel] GEOS Exceptions
In-Reply-To: <4264DFD7.5090804@pavlenko.uklinux.net>
References: <931f8ea90504180816360bfa38@mail.gmail.com>
	<20050418153411.GB74100@freek.keybit.net>
	<1200950805041810094393d592@mail.gmail.com>
	<20050418171148.GC75408@freek.keybit.net>
	<426400D8.40001@pavlenko.uklinux.net>
	<1200950805041813317b7d5a4d@mail.gmail.com>
	<20050418231848.GA76581@freek.keybit.net>
	<4264DFD7.5090804@pavlenko.uklinux.net>
Message-ID: <20050419112911.GJ76581@freek.keybit.net>

On Tue, Apr 19, 2005 at 11:39:19AM +0100, Artem Pavlenko wrote:
> Hi strk,
> I've coded a couple of tests:
> 
> data =  usa counties WKT 84Mb  3140 MULTIPOLYGONS (created like shp -> 
> postgis -> wkt)
> 
> 1.  GEOS  WKT  reader
>     real    0m24.642s
>     user    0m24.374s
>     sys     0m0.235s
> 
> 2. Mapnik WKT Reader
>    real    0m15.651s
>    user    0m15.215s
>    sys     0m0.223s
> 
> It is not completely fair test, but shows that boost::spirit is fit the job.

Parsing WKT includes creation of GEOS objects, which is probably
different then creating Mapnik objects.
A fair test would be implementing it in GEOS and see how it compares
with current GEOS wkt parser (CVS version).

> Also new approach requires boost::spirit headers ( no libs ) and you get 
> increase in compile time.
> But, it is more elegant then 'StringTokenizer', easier to maintain (you 
> can add more grammar later) and can be optimized even more.
> 
> What do you reckon? I can send you my test files?
> How is GEOS development process organised?

GEOS development has so far followed JTS development (slowly, very slowly).
Easy of maintainence currently goes with easy of comparison with JTS.

Since JTS is getting its own C/C++ wrappers this might change in the
future letting GEOS take its own path, but I can't tell how long would
it take and if that would be worth the trouble.

BOOST usage has been discussed for other things as well (smart pointers)
and I always tried to avoid dependency on it. Anyway, if it really gives
us a good performance improvement and we can ship required headers with
GEOS we can do it w/out big problems.

> Also, I've noticed that GEOS  using incorrect WKT grammar IMHO  e.g
> POINT(EMPTY)????
> 
> OpenGIS Simple Features Specification rev1.1 EBNF:
> 
> <Point Text> := EMPTY | (<Point>)
> 
> According to ISO/IEC 14977 'EMPTY' means literally empty as far as I 
> understand,
> and valid WKT for point geometry: POINT  or POINT (x y)
> The same applies to the rest.
> 
> Have you looked into that? Am i missing something?

PostGIS parser doesn't also understand 'POINT' but handles 'POINT EMPTY'.
... do you have knowledge of other WKT readers using that interpretation
of OGC EBNF ?

--strk;

> 
> Cheers!
> 
> Artem
> 
> 
> 
> 
> _______________________________________________
> geos-devel mailing list
> geos-devel@geos.refractions.net
> http://geos.refractions.net/mailman/listinfo/geos-devel

From artem at pavlenko.uklinux.net  Tue Apr 19 08:46:51 2005
From: artem at pavlenko.uklinux.net (Artem Pavlenko)
Date: Fri Nov  2 20:52:41 2007
Subject: [geos-devel] GEOS Exceptions
In-Reply-To: <20050419112911.GJ76581@freek.keybit.net>
References: <931f8ea90504180816360bfa38@mail.gmail.com>	<20050418153411.GB74100@freek.keybit.net>	<1200950805041810094393d592@mail.gmail.com>	<20050418171148.GC75408@freek.keybit.net>	<426400D8.40001@pavlenko.uklinux.net>	<1200950805041813317b7d5a4d@mail.gmail.com>	<20050418231848.GA76581@freek.keybit.net>	<4264DFD7.5090804@pavlenko.uklinux.net>
	<20050419112911.GJ76581@freek.keybit.net>
Message-ID: <4264FDBB.8030002@pavlenko.uklinux.net>

HI Strk!

>
>Parsing WKT includes creation of GEOS objects, which is probably
>different then creating Mapnik objects.
>  
>
Yep, in my test I'm creating a 'dummy' geometries, something like

struct geometry
{
    vector<pair<double,double> > ponts;
}

>A fair test would be implementing it in GEOS and see how it compares
>with current GEOS wkt parser (CVS version).
>  
>
Yes, I'll be into that.  Once I conquer SLD/Filter I'll be able to do that.

>GEOS development has so far followed JTS development (slowly, very slowly).
>Easy of maintainence currently goes with easy of comparison with JTS.
>
>  
>
Umm...? It also runs " ..slowly, very slowly.."
Better design == easy maintenance

>Since JTS is getting its own C/C++ wrappers this might change in the
>future letting GEOS take its own path, but I can't tell how long would
>it take and if that would be worth the trouble.
>
>  
>
Are you serious? C/C++ wrappers is the future?
Anyway, what about Dale Lutz efforts? Are we going to see those changes? 
Is it going to be GEOS2?
Could we have GEOS2 experimental branch?  I'd like to get involved if 
anybody else is interested?

>BOOST usage has been discussed for other things as well (smart pointers)
>and I always tried to avoid dependency on it. Anyway, if it really gives
>us a good performance improvement and we can ship required headers with
>GEOS we can do it w/out big problems.
>  
>
I dont see any problems with that. AFAIK current boost licence is 
compatible with (L)GPL.
see  http://www.fsf.org/licensing/licenses/license-list.html

>>Also, I've noticed that GEOS  using incorrect WKT grammar IMHO  e.g
>>POINT(EMPTY)????
>>
>>OpenGIS Simple Features Specification rev1.1 EBNF:
>>
>><Point Text> := EMPTY | (<Point>)
>>
>>According to ISO/IEC 14977 'EMPTY' means literally empty as far as I 
>>understand,
>>and valid WKT for point geometry: POINT  or POINT (x y)
>>The same applies to the rest.
>>
>>Have you looked into that? Am i missing something?
>>    
>>
>
>PostGIS parser doesn't also understand 'POINT' but handles 'POINT EMPTY'.
>  
>
Add OGR to this list as well. If this is not correct let's change it now.

>... do you have knowledge of other WKT readers using that interpretation
>of OGC EBNF ?
>
>  
>
Assuming 'that interpretation' means OGC Simple Features Specification, 
then mapnik's parser is fully compatible with OGC EBNF for WKT. Anyway, 
the point I'm trying to make is that it will take one liner change to go 
from  POINT  EMPTY to POINT in grammar based parser. Not so easy with 
StringTokenizer:(

I suspect cadcorp and others do a better job at parsing WKT:), but  I 
haven't tried it for a while


Cheers!
Artem


From fwarmerdam at gmail.com  Tue Apr 19 09:05:59 2005
From: fwarmerdam at gmail.com (Frank Warmerdam)
Date: Fri Nov  2 20:52:41 2007
Subject: [geos-devel] GEOS Exceptions
In-Reply-To: <4264FDBB.8030002@pavlenko.uklinux.net>
References: <931f8ea90504180816360bfa38@mail.gmail.com>
	<20050418153411.GB74100@freek.keybit.net>
	<1200950805041810094393d592@mail.gmail.com>
	<20050418171148.GC75408@freek.keybit.net>
	<426400D8.40001@pavlenko.uklinux.net>
	<1200950805041813317b7d5a4d@mail.gmail.com>
	<20050418231848.GA76581@freek.keybit.net>
	<4264DFD7.5090804@pavlenko.uklinux.net>
	<20050419112911.GJ76581@freek.keybit.net>
	<4264FDBB.8030002@pavlenko.uklinux.net>
Message-ID: <931f8ea9050419060543e7beda@mail.gmail.com>

On 4/19/05, Artem Pavlenko <artem@pavlenko.uklinux.net> wrote:
> >BOOST usage has been discussed for other things as well (smart pointers)
> >and I always tried to avoid dependency on it. Anyway, if it really gives
> >us a good performance improvement and we can ship required headers with
> >GEOS we can do it w/out big problems.
> >
> >
> I dont see any problems with that. AFAIK current boost licence is
> compatible with (L)GPL.
> see  http://www.fsf.org/licensing/licenses/license-list.html

Folks,

If all Boost requirements can be easily distributed with GEOS without
complicating builds too much, then it might be quite acceptable.  
 
> >>Also, I've noticed that GEOS  using incorrect WKT grammar IMHO  e.g
> >>POINT(EMPTY)????
> >>
> >>OpenGIS Simple Features Specification rev1.1 EBNF:
> >>
> >><Point Text> := EMPTY | (<Point>)
...

Hmm, this does look like it shoud be "POINT EMPTY" instead of the
"POINT(EMPTY)" I have implemented based on input from someone else. 
I'll ask Martin at Cadcorp what he thinks. 

Best regards,
-- 
---------------------------------------+--------------------------------------
I set the clouds in motion - turn up   | Frank Warmerdam, warmerdam@pobox.com
light and sound - activate the windows | http://pobox.com/~warmerdam
and watch the world go round - Rush    | Geospatial Programmer for Rent

From artem at pavlenko.uklinux.net  Tue Apr 19 09:24:51 2005
From: artem at pavlenko.uklinux.net (Artem Pavlenko)
Date: Fri Nov  2 20:52:41 2007
Subject: [geos-devel] GEOS Exceptions
In-Reply-To: <931f8ea9050419060543e7beda@mail.gmail.com>
References: <931f8ea90504180816360bfa38@mail.gmail.com>	<20050418153411.GB74100@freek.keybit.net>	<1200950805041810094393d592@mail.gmail.com>	<20050418171148.GC75408@freek.keybit.net>	<426400D8.40001@pavlenko.uklinux.net>	<1200950805041813317b7d5a4d@mail.gmail.com>	<20050418231848.GA76581@freek.keybit.net>	<4264DFD7.5090804@pavlenko.uklinux.net>	<20050419112911.GJ76581@freek.keybit.net>	<4264FDBB.8030002@pavlenko.uklinux.net>
	<931f8ea9050419060543e7beda@mail.gmail.com>
Message-ID: <426506A3.1040105@pavlenko.uklinux.net>

Hi Frank

>...
>
>Hmm, this does look like it shoud be "POINT EMPTY" instead of the
>"POINT(EMPTY)" I have implemented based on input from someone else.
>
Yes, the question is POINT or POINT EMPTY?

> 
>I'll ask Martin at Cadcorp what he thinks.
>
Say hello from me, we used work together:)

> 
>
>  
>
Cheers!
Artem


From fwarmerdam at gmail.com  Tue Apr 19 09:27:06 2005
From: fwarmerdam at gmail.com (Frank Warmerdam)
Date: Fri Nov  2 20:52:41 2007
Subject: [geos-devel] GEOS Exceptions
In-Reply-To: <426506A3.1040105@pavlenko.uklinux.net>
References: <931f8ea90504180816360bfa38@mail.gmail.com>
	<20050418171148.GC75408@freek.keybit.net>
	<426400D8.40001@pavlenko.uklinux.net>
	<1200950805041813317b7d5a4d@mail.gmail.com>
	<20050418231848.GA76581@freek.keybit.net>
	<4264DFD7.5090804@pavlenko.uklinux.net>
	<20050419112911.GJ76581@freek.keybit.net>
	<4264FDBB.8030002@pavlenko.uklinux.net>
	<931f8ea9050419060543e7beda@mail.gmail.com>
	<426506A3.1040105@pavlenko.uklinux.net>
Message-ID: <931f8ea90504190627beb875e@mail.gmail.com>

On 4/19/05, Artem Pavlenko <artem@pavlenko.uklinux.net> wrote:
> Hi Frank
> 
> >...
> >
> >Hmm, this does look like it shoud be "POINT EMPTY" instead of the
> >"POINT(EMPTY)" I have implemented based on input from someone else.
> >
> Yes, the question is POINT or POINT EMPTY?
> 
> >
> >I'll ask Martin at Cadcorp what he thinks.
> >
> Say hello from me, we used work together:)

Folks,

It would appear that it wasn't Martin that prodded me into EMPTY 
support as Cadcorp SIS doesn't support any of these variations yet.
I am adjusting the OGR implementation to product in the form
"POINT EMPTY" though I will continue to consume "POINT(EMPTY)"
as well.  

Were some people thinking that EMPTY was a special keyword meaning
nothing at all in EBNF? 

Best regards,

-- 
---------------------------------------+--------------------------------------
I set the clouds in motion - turn up   | Frank Warmerdam, warmerdam@pobox.com
light and sound - activate the windows | http://pobox.com/~warmerdam
and watch the world go round - Rush    | Geospatial Programmer for Rent

From tmacy at mapshots.com  Tue Apr 19 09:30:13 2005
From: tmacy at mapshots.com (Ted Macy)
Date: Fri Nov  2 20:52:41 2007
Subject: [geos-devel] GEOS Exceptions
In-Reply-To: <931f8ea90504190627beb875e@mail.gmail.com>
Message-ID: <20050419092778.SM02020@mobiledog>

Yes, thinking that EMPTY is a special keyword.

-----Original Message-----
From: geos-devel-bounces@geos.refractions.net
[mailto:geos-devel-bounces@geos.refractions.net] On Behalf Of Frank
Warmerdam
Sent: Tuesday, April 19, 2005 9:27 AM
To: Artem Pavlenko
Cc: GEOS Development List
Subject: Re: [geos-devel] GEOS Exceptions

On 4/19/05, Artem Pavlenko <artem@pavlenko.uklinux.net> wrote:
> Hi Frank
> 
> >...
> >
> >Hmm, this does look like it shoud be "POINT EMPTY" instead of the
> >"POINT(EMPTY)" I have implemented based on input from someone else.
> >
> Yes, the question is POINT or POINT EMPTY?
> 
> >
> >I'll ask Martin at Cadcorp what he thinks.
> >
> Say hello from me, we used work together:)

Folks,

It would appear that it wasn't Martin that prodded me into EMPTY 
support as Cadcorp SIS doesn't support any of these variations yet.
I am adjusting the OGR implementation to product in the form
"POINT EMPTY" though I will continue to consume "POINT(EMPTY)"
as well.  

Were some people thinking that EMPTY was a special keyword meaning
nothing at all in EBNF? 

Best regards,

-- 
---------------------------------------+------------------------------------
--
I set the clouds in motion - turn up   | Frank Warmerdam,
warmerdam@pobox.com
light and sound - activate the windows | http://pobox.com/~warmerdam
and watch the world go round - Rush    | Geospatial Programmer for Rent
_______________________________________________
geos-devel mailing list
geos-devel@geos.refractions.net
http://geos.refractions.net/mailman/listinfo/geos-devel




From artem at pavlenko.uklinux.net  Tue Apr 19 09:33:16 2005
From: artem at pavlenko.uklinux.net (Artem Pavlenko)
Date: Fri Nov  2 20:52:41 2007
Subject: [geos-devel] GEOS Exceptions
In-Reply-To: <931f8ea90504190627beb875e@mail.gmail.com>
References: <931f8ea90504180816360bfa38@mail.gmail.com>	
	<20050418171148.GC75408@freek.keybit.net>	
	<426400D8.40001@pavlenko.uklinux.net>	
	<1200950805041813317b7d5a4d@mail.gmail.com>	
	<20050418231848.GA76581@freek.keybit.net>	
	<4264DFD7.5090804@pavlenko.uklinux.net>	
	<20050419112911.GJ76581@freek.keybit.net>	
	<4264FDBB.8030002@pavlenko.uklinux.net>	
	<931f8ea9050419060543e7beda@mail.gmail.com>	
	<426506A3.1040105@pavlenko.uklinux.net>
	<931f8ea90504190627beb875e@mail.gmail.com>
Message-ID: <4265089C.7010807@pavlenko.uklinux.net>

Hi Frank

I think EMPTY means literaly empty
have a look at http://www.cl.cam.ac.uk/%7Emgk25/iso-14977.pdf

cheers
Artem

From sgillies at frii.com  Tue Apr 19 09:40:59 2005
From: sgillies at frii.com (Sean Gillies)
Date: Fri Nov  2 20:52:41 2007
Subject: [geos-devel] thread safety?
Message-ID: <e3494d1e20aa2c62fe549c91a1b84246@frii.com>

Is GEOS thread safe?

Sean

--
Sean Gillies
sgillies at frii dot com
http://users.frii.com/sgillies


From strk at refractions.net  Tue Apr 19 09:41:53 2005
From: strk at refractions.net (strk@refractions.net)
Date: Fri Nov  2 20:52:41 2007
Subject: [geos-devel] GEOS Exceptions
In-Reply-To: <4265089C.7010807@pavlenko.uklinux.net>
References: <426400D8.40001@pavlenko.uklinux.net>
	<1200950805041813317b7d5a4d@mail.gmail.com>
	<20050418231848.GA76581@freek.keybit.net>
	<4264DFD7.5090804@pavlenko.uklinux.net>
	<20050419112911.GJ76581@freek.keybit.net>
	<4264FDBB.8030002@pavlenko.uklinux.net>
	<931f8ea9050419060543e7beda@mail.gmail.com>
	<426506A3.1040105@pavlenko.uklinux.net>
	<931f8ea90504190627beb875e@mail.gmail.com>
	<4265089C.7010807@pavlenko.uklinux.net>
Message-ID: <20050419134153.GA86198@freek.keybit.net>

On Tue, Apr 19, 2005 at 02:33:16PM +0100, Artem Pavlenko wrote:
> Hi Frank
> 
> I think EMPTY means literaly empty
> have a look at http://www.cl.cam.ac.uk/%7Emgk25/iso-14977.pdf

Actually, reading the grammar in OGC SFS 1.1 it doesn't look as
EMPTY has a special meaning:

<Point Tagged Text> :=
           POINT <Point Text>

<Point Text> := EMPTY | ( <Point> )

<Point> := <x> <y>

<x> := double precision literal
<y> := double precision literal


Things with special meaning are wrapped in <> brackets or lowercase
so that would be a <Empty> or 'empty sequence'.
EMPTY looks like POINT, which is verbatim.

--strk;

From fwarmerdam at gmail.com  Tue Apr 19 09:45:47 2005
From: fwarmerdam at gmail.com (Frank Warmerdam)
Date: Fri Nov  2 20:52:41 2007
Subject: [geos-devel] GEOS Exceptions
In-Reply-To: <4265089C.7010807@pavlenko.uklinux.net>
References: <931f8ea90504180816360bfa38@mail.gmail.com>
	<1200950805041813317b7d5a4d@mail.gmail.com>
	<20050418231848.GA76581@freek.keybit.net>
	<4264DFD7.5090804@pavlenko.uklinux.net>
	<20050419112911.GJ76581@freek.keybit.net>
	<4264FDBB.8030002@pavlenko.uklinux.net>
	<931f8ea9050419060543e7beda@mail.gmail.com>
	<426506A3.1040105@pavlenko.uklinux.net>
	<931f8ea90504190627beb875e@mail.gmail.com>
	<4265089C.7010807@pavlenko.uklinux.net>
Message-ID: <931f8ea905041906454ae8ee33@mail.gmail.com>

On 4/19/05, Artem Pavlenko <artem@pavlenko.uklinux.net> wrote:
> Hi Frank
> 
> I think EMPTY means literaly empty
> have a look at http://www.cl.cam.ac.uk/%7Emgk25/iso-14977.pdf

Artem, 

I have searched through this, and found nothing that says that EMPTY
is a special keyword in an EBNF grammar meaning nothing. 

In section 8.3 they have an EMPTY value, something like this:

PRIMARY
  = OPTIONAL SEQUENCE / REPEATED SEQUENCE
  / SPECIAL SEQUENCE / GROUPED SEQUENCE
  / META IDENTIFIER / TERMINAL / EMPTY.
EMPTY = .

This does not suggest to me that EMPTY is a real keyword you
can include in EBNF grammars with a specific predefined meaning. 

To be honest, I am a bit disgusted that this complication was left without
examples in the Simple Features for SQL specification. 

So, as I read the SFSQL spec, I am still left with the believe that 
an empty POINT should be expressed as "POINT EMPTY".  But
now I am inclined to halt my work on implementation till we have
broader agreement. 

Best regards,
---------------------------------------+--------------------------------------
I set the clouds in motion - turn up   | Frank Warmerdam, warmerdam@pobox.com
light and sound - activate the windows | http://pobox.com/~warmerdam
and watch the world go round - Rush    | Geospatial Programmer for Rent

From artem at pavlenko.uklinux.net  Tue Apr 19 09:46:46 2005
From: artem at pavlenko.uklinux.net (Artem Pavlenko)
Date: Fri Nov  2 20:52:41 2007
Subject: [geos-devel] GEOS Exceptions
In-Reply-To: <20050419134153.GA86198@freek.keybit.net>
References: <426400D8.40001@pavlenko.uklinux.net>	<1200950805041813317b7d5a4d@mail.gmail.com>	<20050418231848.GA76581@freek.keybit.net>	<4264DFD7.5090804@pavlenko.uklinux.net>	<20050419112911.GJ76581@freek.keybit.net>	<4264FDBB.8030002@pavlenko.uklinux.net>	<931f8ea9050419060543e7beda@mail.gmail.com>	<426506A3.1040105@pavlenko.uklinux.net>	<931f8ea90504190627beb875e@mail.gmail.com>	<4265089C.7010807@pavlenko.uklinux.net>
	<20050419134153.GA86198@freek.keybit.net>
Message-ID: <42650BC6.4020707@pavlenko.uklinux.net>

strk@refractions.net wrote:

>On Tue, Apr 19, 2005 at 02:33:16PM +0100, Artem Pavlenko wrote:
>  
>
>>Hi Frank
>>
>>I think EMPTY means literaly empty
>>have a look at http://www.cl.cam.ac.uk/%7Emgk25/iso-14977.pdf
>>    
>>
>
>Actually, reading the grammar in OGC SFS 1.1 it doesn't look as
>EMPTY has a special meaning:
>
><Point Tagged Text> :=
>           POINT <Point Text>
>
><Point Text> := EMPTY | ( <Point> )
>
><Point> := <x> <y>
>
><x> := double precision literal
><y> := double precision literal
>
>
>Things with special meaning are wrapped in <> brackets or lowercase
>so that would be a <Empty> or 'empty sequence'.
>EMPTY looks like POINT, which is verbatim.
>
>  
>
Agree, it is ambiguous, yet ISO-EBNF lists EMPTY as a special keyword.
Can anyone ask OGC folks?
Artem


From strk at refractions.net  Tue Apr 19 10:03:26 2005
From: strk at refractions.net (strk@refractions.net)
Date: Fri Nov  2 20:52:41 2007
Subject: [geos-devel] thread safety?
In-Reply-To: <e3494d1e20aa2c62fe549c91a1b84246@frii.com>
References: <e3494d1e20aa2c62fe549c91a1b84246@frii.com>
Message-ID: <20050419140326.GB86198@freek.keybit.net>

On Tue, Apr 19, 2005 at 07:40:59AM -0600, Sean Gillies wrote:
> Is GEOS thread safe?

Good question. Can it be tested ?
--strk;

> 
> Sean
> 
> --
> Sean Gillies
> sgillies at frii dot com
> http://users.frii.com/sgillies
> 
> _______________________________________________
> geos-devel mailing list
> geos-devel@geos.refractions.net
> http://geos.refractions.net/mailman/listinfo/geos-devel

From sgillies at frii.com  Tue Apr 19 10:16:35 2005
From: sgillies at frii.com (Sean Gillies)
Date: Fri Nov  2 20:52:41 2007
Subject: [geos-devel] thread safety?
In-Reply-To: <20050419140326.GB86198@freek.keybit.net>
References: <e3494d1e20aa2c62fe549c91a1b84246@frii.com>
	<20050419140326.GB86198@freek.keybit.net>
Message-ID: <fa158042635d1fad691fd1ce439ba769@frii.com>

On Apr 19, 2005, at 8:03 AM, strk@refractions.net wrote:

> On Tue, Apr 19, 2005 at 07:40:59AM -0600, Sean Gillies wrote:
>> Is GEOS thread safe?
>
> Good question. Can it be tested ?
> --strk;
>

Ah, thrown back at me :)  I just want to know if thread safety was a 
design goal and if the goal has been achieved.  Looking back in the 
archives I found a thread where Martin had stated that GEOS should aim 
to be safe, and another where Dave Blasby asked the same question with 
no answer.

It's not so much a concern for PostgreSQL, but for other uses.  I'd 
like to avoid synchronizing use of GEOS if I didn't need to do so.

cheers,
Sean

--
Sean Gillies
sgillies at frii dot com
http://users.frii.com/sgillies


From ferdinando.villa at uvm.edu  Tue Apr 19 10:25:28 2005
From: ferdinando.villa at uvm.edu (Ferdinando Villa)
Date: Fri Nov  2 20:52:41 2007
Subject: [geos-devel] thread safety?
In-Reply-To: <fa158042635d1fad691fd1ce439ba769@frii.com>
References: <e3494d1e20aa2c62fe549c91a1b84246@frii.com>
	<20050419140326.GB86198@freek.keybit.net>
	<fa158042635d1fad691fd1ce439ba769@frii.com>
Message-ID: <1113920727.4866.14.camel@basil.snr.uvm.edu>

I can't vow for the thread safety of GEOS in general, but I'm using it
in quite a few asynchronous functions within a threadpool server which
gets a lot of daily use, and never had a problem. Of course its current
design requires attention, and you must be careful where do you put all
these pointers, but that's not just for thread safety :)

ferdinando

On Tue, 2005-04-19 at 10:16, Sean Gillies wrote:
> On Apr 19, 2005, at 8:03 AM, strk@refractions.net wrote:
> 
> > On Tue, Apr 19, 2005 at 07:40:59AM -0600, Sean Gillies wrote:
> >> Is GEOS thread safe?
> >
> > Good question. Can it be tested ?
> > --strk;
> >
> 
> Ah, thrown back at me :)  I just want to know if thread safety was a 
> design goal and if the goal has been achieved.  Looking back in the 
> archives I found a thread where Martin had stated that GEOS should aim 
> to be safe, and another where Dave Blasby asked the same question with 
> no answer.
> 
> It's not so much a concern for PostgreSQL, but for other uses.  I'd 
> like to avoid synchronizing use of GEOS if I didn't need to do so.
> 
> cheers,
> Sean
> 
> --
> Sean Gillies
> sgillies at frii dot com
> http://users.frii.com/sgillies
> 
> _______________________________________________
> geos-devel mailing list
> geos-devel@geos.refractions.net
> http://geos.refractions.net/mailman/listinfo/geos-devel
-- 
Ferdinando Villa, Ph.D., Associate Research Professor, Ecoinformatics
Gund Institute for Ecological Economics and Dept of Botany, Univ. of Vermont
http://ecoinformatics.uvm.edu


From fwarmerdam at gmail.com  Tue Apr 19 10:50:25 2005
From: fwarmerdam at gmail.com (Frank Warmerdam)
Date: Fri Nov  2 20:52:41 2007
Subject: [geos-devel] GEOS Exceptions
In-Reply-To: <42650BC6.4020707@pavlenko.uklinux.net>
References: <426400D8.40001@pavlenko.uklinux.net>
	<4264DFD7.5090804@pavlenko.uklinux.net>
	<20050419112911.GJ76581@freek.keybit.net>
	<4264FDBB.8030002@pavlenko.uklinux.net>
	<931f8ea9050419060543e7beda@mail.gmail.com>
	<426506A3.1040105@pavlenko.uklinux.net>
	<931f8ea90504190627beb875e@mail.gmail.com>
	<4265089C.7010807@pavlenko.uklinux.net>
	<20050419134153.GA86198@freek.keybit.net>
	<42650BC6.4020707@pavlenko.uklinux.net>
Message-ID: <931f8ea9050419075068a6010@mail.gmail.com>

On 4/19/05, Artem Pavlenko <artem@pavlenko.uklinux.net> wrote:
> Agree, it is ambiguous, yet ISO-EBNF lists EMPTY as a special keyword.
> Can anyone ask OGC folks?
> Artem

Artem, 

I have emailed David Arctur, who is now co-chair of the reformed
Simple Features Revision Working Group - or so I have been told.
My understanding is that the main RWG task is update the spec to 
include 2.5 geometries, and the new measure suggestions. 

I have asked him for the correct EMPTY handling interpretation,
and encouraging his RWG to clarify this in the next generation of
the specification as it is clearly confusing to quite alot of us. 

Best regards,
-- 
---------------------------------------+--------------------------------------
I set the clouds in motion - turn up   | Frank Warmerdam, warmerdam@pobox.com
light and sound - activate the windows | http://pobox.com/~warmerdam
and watch the world go round - Rush    | Geospatial Programmer for Rent

From artem at pavlenko.uklinux.net  Tue Apr 19 10:59:44 2005
From: artem at pavlenko.uklinux.net (Artem Pavlenko)
Date: Fri Nov  2 20:52:41 2007
Subject: [geos-devel] GEOS Exceptions
In-Reply-To: <931f8ea9050419075068a6010@mail.gmail.com>
References: <426400D8.40001@pavlenko.uklinux.net>	<4264DFD7.5090804@pavlenko.uklinux.net>	<20050419112911.GJ76581@freek.keybit.net>	<4264FDBB.8030002@pavlenko.uklinux.net>	<931f8ea9050419060543e7beda@mail.gmail.com>	<426506A3.1040105@pavlenko.uklinux.net>	<931f8ea90504190627beb875e@mail.gmail.com>	<4265089C.7010807@pavlenko.uklinux.net>	<20050419134153.GA86198@freek.keybit.net>	<42650BC6.4020707@pavlenko.uklinux.net>
	<931f8ea9050419075068a6010@mail.gmail.com>
Message-ID: <42651CE0.9090707@pavlenko.uklinux.net>

Frank Warmerdam wrote:

>On 4/19/05, Artem Pavlenko <artem@pavlenko.uklinux.net> wrote:
>  
>
>>Agree, it is ambiguous, yet ISO-EBNF lists EMPTY as a special keyword.
>>Can anyone ask OGC folks?
>>Artem
>>    
>>
>
>Artem, 
>
>I have emailed David Arctur, who is now co-chair of the reformed
>Simple Features Revision Working Group - or so I have been told.
>My understanding is that the main RWG task is update the spec to 
>include 2.5 geometries, and the new measure suggestions. 
>
>I have asked him for the correct EMPTY handling interpretation,
>and encouraging his RWG to clarify this in the next generation of
>the specification as it is clearly confusing to quite alot of us. 
>
>Best regards,
>  
>
Thanks Frank.


From sgillies at frii.com  Tue Apr 19 11:29:18 2005
From: sgillies at frii.com (Sean Gillies)
Date: Fri Nov  2 20:52:41 2007
Subject: [geos-devel] thread safety?
In-Reply-To: <1113920727.4866.14.camel@basil.snr.uvm.edu>
References: <e3494d1e20aa2c62fe549c91a1b84246@frii.com>
	<20050419140326.GB86198@freek.keybit.net>
	<fa158042635d1fad691fd1ce439ba769@frii.com>
	<1113920727.4866.14.camel@basil.snr.uvm.edu>
Message-ID: <010a2341c6309d85bf7a0794d26f9445@frii.com>

Good news!  Thanks, Ferdinando.

Sean

On Apr 19, 2005, at 8:25 AM, Ferdinando Villa wrote:

> I can't vow for the thread safety of GEOS in general, but I'm using it
> in quite a few asynchronous functions within a threadpool server which
> gets a lot of daily use, and never had a problem. Of course its current
> design requires attention, and you must be careful where do you put all
> these pointers, but that's not just for thread safety :)
>
> ferdinando
>
> On Tue, 2005-04-19 at 10:16, Sean Gillies wrote:
>> On Apr 19, 2005, at 8:03 AM, strk@refractions.net wrote:
>>
>>> On Tue, Apr 19, 2005 at 07:40:59AM -0600, Sean Gillies wrote:
>>>> Is GEOS thread safe?
>>>
>>> Good question. Can it be tested ?
>>> --strk;
>>>
>>
>> Ah, thrown back at me :)  I just want to know if thread safety was a
>> design goal and if the goal has been achieved.  Looking back in the
>> archives I found a thread where Martin had stated that GEOS should aim
>> to be safe, and another where Dave Blasby asked the same question with
>> no answer.
>>
>> It's not so much a concern for PostgreSQL, but for other uses.  I'd
>> like to avoid synchronizing use of GEOS if I didn't need to do so.
>>
>> cheers,
>> Sean
>>
>> --
>> Sean Gillies
>> sgillies at frii dot com
>> http://users.frii.com/sgillies
>>
>> _______________________________________________
>> geos-devel mailing list
>> geos-devel@geos.refractions.net
>> http://geos.refractions.net/mailman/listinfo/geos-devel
> -- 
> Ferdinando Villa, Ph.D., Associate Research Professor, Ecoinformatics
> Gund Institute for Ecological Economics and Dept of Botany, Univ. of 
> Vermont
> http://ecoinformatics.uvm.edu
>
> _______________________________________________
> geos-devel mailing list
> geos-devel@geos.refractions.net
> http://geos.refractions.net/mailman/listinfo/geos-devel
>


From chodgson at refractions.net  Tue Apr 19 12:34:11 2005
From: chodgson at refractions.net (Chris Hodgson)
Date: Fri Nov  2 20:52:41 2007
Subject: [geos-devel] GEOS Exceptions
In-Reply-To: <931f8ea905041906454ae8ee33@mail.gmail.com>
References: <931f8ea90504180816360bfa38@mail.gmail.com>	<1200950805041813317b7d5a4d@mail.gmail.com>	<20050418231848.GA76581@freek.keybit.net>	<4264DFD7.5090804@pavlenko.uklinux.net>	<20050419112911.GJ76581@freek.keybit.net>	<4264FDBB.8030002@pavlenko.uklinux.net>	<931f8ea9050419060543e7beda@mail.gmail.com>	<426506A3.1040105@pavlenko.uklinux.net>	<931f8ea90504190627beb875e@mail.gmail.com>	<4265089C.7010807@pavlenko.uklinux.net>
	<931f8ea905041906454ae8ee33@mail.gmail.com>
Message-ID: <42653303.4020606@refractions.net>


>In section 8.3 they have an EMPTY value, something like this:
>
>PRIMARY
>  = OPTIONAL SEQUENCE / REPEATED SEQUENCE
>  / SPECIAL SEQUENCE / GROUPED SEQUENCE
>  / META IDENTIFIER / TERMINAL / EMPTY.
>EMPTY = .
>  
>
If the spec says this as quoted above, then this does in fact mean that 
EMPTY means nothing.
It literally says, EMPTY equals nothing, period. I haven't looked at the 
rest of the spec, but there's nothing ambiguous about it here, IMHO.

Chris

From strk at refractions.net  Tue Apr 19 12:40:34 2005
From: strk at refractions.net (strk@refractions.net)
Date: Fri Nov  2 20:52:41 2007
Subject: [geos-devel] GEOS Exceptions
In-Reply-To: <42653303.4020606@refractions.net>
References: <20050418231848.GA76581@freek.keybit.net>
	<4264DFD7.5090804@pavlenko.uklinux.net>
	<20050419112911.GJ76581@freek.keybit.net>
	<4264FDBB.8030002@pavlenko.uklinux.net>
	<931f8ea9050419060543e7beda@mail.gmail.com>
	<426506A3.1040105@pavlenko.uklinux.net>
	<931f8ea90504190627beb875e@mail.gmail.com>
	<4265089C.7010807@pavlenko.uklinux.net>
	<931f8ea905041906454ae8ee33@mail.gmail.com>
	<42653303.4020606@refractions.net>
Message-ID: <20050419164034.GE86745@freek.keybit.net>

On Tue, Apr 19, 2005 at 09:34:11AM -0700, Chris Hodgson wrote:
> 
> >In section 8.3 they have an EMPTY value, something like this:
> >
> >PRIMARY
> > = OPTIONAL SEQUENCE / REPEATED SEQUENCE
> > / SPECIAL SEQUENCE / GROUPED SEQUENCE
> > / META IDENTIFIER / TERMINAL / EMPTY.
> >EMPTY = .
> > 
> >
> If the spec says this as quoted above, then this does in fact mean that 
> EMPTY means nothing.
> It literally says, EMPTY equals nothing, period. I haven't looked at the 
> rest of the spec, but there's nothing ambiguous about it here, IMHO.

That's not OGC SFS spec, but an example in the EBFN spec.
I think you're right here because EMPTY is defined.
OGS SFS does not define EMPTY, and use <bracketed> strings
for defined things.

--strk;

From chodgson at refractions.net  Tue Apr 19 12:39:08 2005
From: chodgson at refractions.net (Chris Hodgson)
Date: Fri Nov  2 20:52:41 2007
Subject: [geos-devel] GEOS Exceptions
In-Reply-To: <20050419164034.GE86745@freek.keybit.net>
References: <20050418231848.GA76581@freek.keybit.net>	<4264DFD7.5090804@pavlenko.uklinux.net>	<20050419112911.GJ76581@freek.keybit.net>	<4264FDBB.8030002@pavlenko.uklinux.net>	<931f8ea9050419060543e7beda@mail.gmail.com>	<426506A3.1040105@pavlenko.uklinux.net>	<931f8ea90504190627beb875e@mail.gmail.com>	<4265089C.7010807@pavlenko.uklinux.net>	<931f8ea905041906454ae8ee33@mail.gmail.com>	<42653303.4020606@refractions.net>
	<20050419164034.GE86745@freek.keybit.net>
Message-ID: <4265342C.6030703@refractions.net>

OK, that makes more sense to me then... sorry for the confusion...

Chris

strk@refractions.net wrote:

>On Tue, Apr 19, 2005 at 09:34:11AM -0700, Chris Hodgson wrote:
>  
>
>>>In section 8.3 they have an EMPTY value, something like this:
>>>
>>>PRIMARY
>>>= OPTIONAL SEQUENCE / REPEATED SEQUENCE
>>>/ SPECIAL SEQUENCE / GROUPED SEQUENCE
>>>/ META IDENTIFIER / TERMINAL / EMPTY.
>>>EMPTY = .
>>>
>>>
>>>      
>>>
>>If the spec says this as quoted above, then this does in fact mean that 
>>EMPTY means nothing.
>>It literally says, EMPTY equals nothing, period. I haven't looked at the 
>>rest of the spec, but there's nothing ambiguous about it here, IMHO.
>>    
>>
>
>That's not OGC SFS spec, but an example in the EBFN spec.
>I think you're right here because EMPTY is defined.
>OGS SFS does not define EMPTY, and use <bracketed> strings
>for defined things.
>
>--strk;
>_______________________________________________
>geos-devel mailing list
>geos-devel@geos.refractions.net
>http://geos.refractions.net/mailman/listinfo/geos-devel
>  
>


From mcoletti at gmail.com  Tue Apr 19 14:44:49 2005
From: mcoletti at gmail.com (Mark Coletti)
Date: Fri Nov  2 20:52:41 2007
Subject: [geos-devel] GEOS Exceptions
In-Reply-To: <4264DFD7.5090804@pavlenko.uklinux.net>
References: <931f8ea90504180816360bfa38@mail.gmail.com>
	<20050418153411.GB74100@freek.keybit.net>
	<1200950805041810094393d592@mail.gmail.com>
	<20050418171148.GC75408@freek.keybit.net>
	<426400D8.40001@pavlenko.uklinux.net>
	<1200950805041813317b7d5a4d@mail.gmail.com>
	<20050418231848.GA76581@freek.keybit.net>
	<4264DFD7.5090804@pavlenko.uklinux.net>
Message-ID: <1200950805041911447c4eaf6d@mail.gmail.com>

On 4/19/05, Artem Pavlenko <artem@pavlenko.uklinux.net> wrote:
> Hi strk,
> I've coded a couple of tests:
> 
> data =  usa counties WKT 84Mb  3140 MULTIPOLYGONS (created like shp ->
> postgis -> wkt)
> 
> 1.  GEOS  WKT  reader
>      real    0m24.642s
>      user    0m24.374s
>      sys     0m0.235s
> 
> 2. Mapnik WKT Reader
>     real    0m15.651s
>     user    0m15.215s
>     sys     0m0.223s
> 

Actually it would be best to run these tests multiple times so that
you can assay aggregate behavior -- and use multiple datasets, too.

MAC
-- 
I'm taking reality in small doses to build immunity.

From artem at pavlenko.uklinux.net  Tue Apr 19 15:03:13 2005
From: artem at pavlenko.uklinux.net (Artem Pavlenko)
Date: Fri Nov  2 20:52:41 2007
Subject: [geos-devel] GEOS Exceptions
In-Reply-To: <1200950805041911447c4eaf6d@mail.gmail.com>
References: <931f8ea90504180816360bfa38@mail.gmail.com>	<20050418153411.GB74100@freek.keybit.net>	<1200950805041810094393d592@mail.gmail.com>	<20050418171148.GC75408@freek.keybit.net>	<426400D8.40001@pavlenko.uklinux.net>	<1200950805041813317b7d5a4d@mail.gmail.com>	<20050418231848.GA76581@freek.keybit.net>	<4264DFD7.5090804@pavlenko.uklinux.net>
	<1200950805041911447c4eaf6d@mail.gmail.com>
Message-ID: <426555F1.2080808@pavlenko.uklinux.net>

Mark Coletti wrote:

>On 4/19/05, Artem Pavlenko <artem@pavlenko.uklinux.net> wrote:
>  
>
>>Hi strk,
>>I've coded a couple of tests:
>>
>>data =  usa counties WKT 84Mb  3140 MULTIPOLYGONS (created like shp ->
>>postgis -> wkt)
>>
>>1.  GEOS  WKT  reader
>>     real    0m24.642s
>>     user    0m24.374s
>>     sys     0m0.235s
>>
>>2. Mapnik WKT Reader
>>    real    0m15.651s
>>    user    0m15.215s
>>    sys     0m0.223s
>>
>>    
>>
>
>Actually it would be best to run these tests multiple times so that
>you can assay aggregate behavior -- and use multiple datasets, too.
>
>MAC
>  
>
Yep, have you got multiple datasets?
I'll have a go writing WKTReader for GEOS when I got some time.
This is just to show that there're alternatives to StringTokenizer

Meanwhile , could anyone explain to me why do we need 
vector<Coordinate>*  and not just vector<Coordinate>
in DefaultCoordinateSequence? And again, why  not write:
   struct A
  {
      A(B const& b)
        : b_(b) {}
       B b_;
  };

 instead of:

 struct A
{
    A(B const& b)
   {
        b_=b;
   }
B b_;
};  ???

cheers
Artem

From mcoletti at gmail.com  Tue Apr 19 16:52:12 2005
From: mcoletti at gmail.com (Mark Coletti)
Date: Fri Nov  2 20:52:41 2007
Subject: [geos-devel] GEOS Exceptions
In-Reply-To: <426555F1.2080808@pavlenko.uklinux.net>
References: <931f8ea90504180816360bfa38@mail.gmail.com>
	<20050418153411.GB74100@freek.keybit.net>
	<1200950805041810094393d592@mail.gmail.com>
	<20050418171148.GC75408@freek.keybit.net>
	<426400D8.40001@pavlenko.uklinux.net>
	<1200950805041813317b7d5a4d@mail.gmail.com>
	<20050418231848.GA76581@freek.keybit.net>
	<4264DFD7.5090804@pavlenko.uklinux.net>
	<1200950805041911447c4eaf6d@mail.gmail.com>
	<426555F1.2080808@pavlenko.uklinux.net>
Message-ID: <12009508050419135265cca4c2@mail.gmail.com>

On 4/19/05, Artem Pavlenko <artem@pavlenko.uklinux.net> wrote:
> Mark Coletti wrote:
> 

> >Actually it would be best to run these tests multiple times so that
> >you can assay aggregate behavior -- and use multiple datasets, too.

> Yep, have you got multiple datasets?

Um, no, but I'll be happy to perform t-tests to 95% confidence levels
on run results.  =)

(What, ME, a computer scientist?)

> I'll have a go writing WKTReader for GEOS when I got some time. [...]

I'm looking forward to the results.

> Meanwhile , could anyone explain to me why do we need
> vector<Coordinate>*  and not just vector<Coordinate>
> in DefaultCoordinateSequence? 

Oh, my.  I hope it's not for some perverse form of vector re-sizing.

And again, why  not write:
>    struct A
>   {
>       A(B const& b)
>         : b_(b) {}
>        B b_;
>   };
> 
>  instead of:

Yep.  From _Effective C++_, "Item 12: Prefer initialization to 
assignment in constructors."  (Unfortunately this problem is also rife
in QuantumGIS source.)

MAC
-- 
I'm taking reality in small doses to build immunity.

From fwarmerdam at gmail.com  Tue Apr 19 16:58:08 2005
From: fwarmerdam at gmail.com (Frank Warmerdam)
Date: Fri Nov  2 20:52:41 2007
Subject: [geos-devel] WKT EMPTY
Message-ID: <931f8ea905041913583ea9541a@mail.gmail.com>

Folks,

David Arctur is uncertain about the WKT EMPTY issue himself, so at 
this point we have no clear answer on what is right or wrong.  He has
agreed that this point should be clarified in future versions of the 
simple features spec by the revision working group. 

But that doesn't help us here and now. 

PS. Forgive me for changing the subject - I think the GEOS Exceptions
subject line was getting a little to general-purpose. 

Best regards,
-- 
---------------------------------------+--------------------------------------
I set the clouds in motion - turn up   | Frank Warmerdam, warmerdam@pobox.com
light and sound - activate the windows | http://pobox.com/~warmerdam
and watch the world go round - Rush    | Geospatial Programmer for Rent

From mbdavis at VividSolutions.com  Tue Apr 19 17:19:28 2005
From: mbdavis at VividSolutions.com (Martin Davis)
Date: Fri Nov  2 20:52:41 2007
Subject: [geos-devel] WKT EMPTY
Message-ID: <5A94289A9268514C8D6C0F1FF44BA0272258E3@venus.VividSolutions.com>

Can't resist adding my 2c worth...

To my mind, it's pretty clear that the intent of the syntax spec is that
words in all UPPERCASE are intended to be literals in the WKT language.
In this case, the representation of an empty Point is

POINT EMPTY

This interpretation also has the advantage of being unambiguous and
explicit.  If the representation was POINT only, there are two
interpretations:

- an empty Point
- an incorrect Point representation, with the actual coordinate missing

I guess the spec authors may have the final word, but until they weigh
in I'd vote for sticking with POINT EMPTY.

Martin Davis, Senior Technical Architect
Vivid Solutions Inc.      www.vividsolutions.com
Suite #1A-2328 Government Street Victoria, B.C. V8T 5G5
Phone: (250) 385 6040 - Local 308 Fax: (250) 385 6046


> -----Original Message-----
> From: geos-devel-bounces@geos.refractions.net 
> [mailto:geos-devel-bounces@geos.refractions.net] On Behalf Of 
> Frank Warmerdam
> Sent: April 19, 2005 1:58 PM
> To: GEOS Development List
> Subject: [geos-devel] WKT EMPTY
> 
> 
> Folks,
> 
> David Arctur is uncertain about the WKT EMPTY issue himself, so at 
> this point we have no clear answer on what is right or wrong. 
>  He has agreed that this point should be clarified in future 
> versions of the 
> simple features spec by the revision working group. 
> 
> But that doesn't help us here and now. 
> 
> PS. Forgive me for changing the subject - I think the GEOS 
> Exceptions subject line was getting a little to general-purpose. 
> 
> Best regards,
> -- 
> ---------------------------------------+----------------------
----------
> ---------------------------------------+------
> I set the clouds in motion - turn up   | Frank Warmerdam, 
> warmerdam@pobox.com
> light and sound - activate the windows | http://pobox.com/~warmerdam
> and watch the world go round - Rush    | Geospatial 
> Programmer for Rent
> _______________________________________________
> geos-devel mailing list
> geos-devel@geos.refractions.net 
> http://geos.refractions.net/mailman/listinfo/geos-devel
> 

From strk at refractions.net  Wed Apr 20 04:13:46 2005
From: strk at refractions.net (strk@refractions.net)
Date: Fri Nov  2 20:52:41 2007
Subject: [geos-devel] GEOS Exceptions
In-Reply-To: <12009508050419135265cca4c2@mail.gmail.com>
References: <20050418153411.GB74100@freek.keybit.net>
	<1200950805041810094393d592@mail.gmail.com>
	<20050418171148.GC75408@freek.keybit.net>
	<426400D8.40001@pavlenko.uklinux.net>
	<1200950805041813317b7d5a4d@mail.gmail.com>
	<20050418231848.GA76581@freek.keybit.net>
	<4264DFD7.5090804@pavlenko.uklinux.net>
	<1200950805041911447c4eaf6d@mail.gmail.com>
	<426555F1.2080808@pavlenko.uklinux.net>
	<12009508050419135265cca4c2@mail.gmail.com>
Message-ID: <20050420081346.GC88619@freek.keybit.net>

On Tue, Apr 19, 2005 at 04:52:12PM -0400, Mark Coletti wrote:
> On 4/19/05, Artem Pavlenko <artem@pavlenko.uklinux.net> wrote:
...
> > Meanwhile , could anyone explain to me why do we need
> > vector<Coordinate>*  and not just vector<Coordinate>
> > in DefaultCoordinateSequence? 
> 
> Oh, my.  I hope it's not for some perverse form of vector re-sizing.

I found it like that and failed to clean it up as most of the current
code. Changing - again - will break API.
Actually I think we can really start a GEOS3 branch and do a big
lifting on it.

> And again, why  not write:
> >    struct A
> >   {
> >       A(B const& b)
> >         : b_(b) {}
> >        B b_;
> >   };

We can do this and I actually started doing it somewhere, but as far
as args are pointers this doesn't really speed things up...

--strk;

> > 
> >  instead of:
> 
> Yep.  From _Effective C++_, "Item 12: Prefer initialization to 
> assignment in constructors."  (Unfortunately this problem is also rife
> in QuantumGIS source.)
> 
> MAC
> -- 
> I'm taking reality in small doses to build immunity.
> _______________________________________________
> geos-devel mailing list
> geos-devel@geos.refractions.net
> http://geos.refractions.net/mailman/listinfo/geos-devel

From strk at refractions.net  Wed Apr 20 04:15:19 2005
From: strk at refractions.net (strk@refractions.net)
Date: Fri Nov  2 20:52:41 2007
Subject: [geos-devel] WKT EMPTY
In-Reply-To: <5A94289A9268514C8D6C0F1FF44BA0272258E3@venus.VividSolutions.com>
References: <5A94289A9268514C8D6C0F1FF44BA0272258E3@venus.VividSolutions.com>
Message-ID: <20050420081519.GD88619@freek.keybit.net>

I agree, POINT EMPTY would be easier to implement, and already has
more implementations then just POINT.

--strk;

On Tue, Apr 19, 2005 at 02:19:28PM -0700, Martin Davis wrote:
> Can't resist adding my 2c worth...
> 
> To my mind, it's pretty clear that the intent of the syntax spec is that
> words in all UPPERCASE are intended to be literals in the WKT language.
> In this case, the representation of an empty Point is
> 
> POINT EMPTY
> 
> This interpretation also has the advantage of being unambiguous and
> explicit.  If the representation was POINT only, there are two
> interpretations:
> 
> - an empty Point
> - an incorrect Point representation, with the actual coordinate missing
> 
> I guess the spec authors may have the final word, but until they weigh
> in I'd vote for sticking with POINT EMPTY.
> 
> Martin Davis, Senior Technical Architect
> Vivid Solutions Inc.      www.vividsolutions.com
> Suite #1A-2328 Government Street Victoria, B.C. V8T 5G5
> Phone: (250) 385 6040 - Local 308 Fax: (250) 385 6046
> 
> 
> > -----Original Message-----
> > From: geos-devel-bounces@geos.refractions.net 
> > [mailto:geos-devel-bounces@geos.refractions.net] On Behalf Of 
> > Frank Warmerdam
> > Sent: April 19, 2005 1:58 PM
> > To: GEOS Development List
> > Subject: [geos-devel] WKT EMPTY
> > 
> > 
> > Folks,
> > 
> > David Arctur is uncertain about the WKT EMPTY issue himself, so at 
> > this point we have no clear answer on what is right or wrong. 
> >  He has agreed that this point should be clarified in future 
> > versions of the 
> > simple features spec by the revision working group. 
> > 
> > But that doesn't help us here and now. 
> > 
> > PS. Forgive me for changing the subject - I think the GEOS 
> > Exceptions subject line was getting a little to general-purpose. 
> > 
> > Best regards,
> > -- 
> > ---------------------------------------+----------------------
> ----------
> > ---------------------------------------+------
> > I set the clouds in motion - turn up   | Frank Warmerdam, 
> > warmerdam@pobox.com
> > light and sound - activate the windows | http://pobox.com/~warmerdam
> > and watch the world go round - Rush    | Geospatial 
> > Programmer for Rent
> > _______________________________________________
> > geos-devel mailing list
> > geos-devel@geos.refractions.net 
> > http://geos.refractions.net/mailman/listinfo/geos-devel
> > 
> _______________________________________________
> geos-devel mailing list
> geos-devel@geos.refractions.net
> http://geos.refractions.net/mailman/listinfo/geos-devel

From artem at pavlenko.uklinux.net  Wed Apr 20 04:23:46 2005
From: artem at pavlenko.uklinux.net (Artem Pavlenko)
Date: Fri Nov  2 20:52:41 2007
Subject: [geos-devel] WKT EMPTY
In-Reply-To: <5A94289A9268514C8D6C0F1FF44BA0272258E3@venus.VividSolutions.com>
References: <5A94289A9268514C8D6C0F1FF44BA0272258E3@venus.VividSolutions.com>
Message-ID: <42661192.6010004@pavlenko.uklinux.net>

Martin Davis wrote:

>Can't resist adding my 2c worth...
>
>To my mind, it's pretty clear that the intent of the syntax spec is that
>words in all UPPERCASE are intended to be literals in the WKT language.
>In this case, the representation of an empty Point is
>
>POINT EMPTY
>  
>
OK, but then POINTEMPTY is a valid expression as well.
Surely, it wasn't author intention?

>This interpretation also has the advantage of being unambiguous and
>explicit.  If the representation was POINT only, there are two
>interpretations:
>
>- an empty Point
>- an incorrect Point representation, with the actual coordinate missing
>  
>
Well, how about:

Point with coordinate missing == empty POINT
Always treat a 'POINT' as an empty one.  
  

>I guess the spec authors may have the final word, but until they weigh
>in I'd vote for sticking with POINT EMPTY.
>  
>
Who are the spec authors anyway?  Adam Gawne-Cain was involved in 
designing WKT/WKB when I used work at cadcorp. Is he the author?

I vote for POINT, LINESTRING, POLYGON etc.
It looks nicer!

Regards

Artem Pavlenko


From artem at pavlenko.uklinux.net  Wed Apr 20 04:30:27 2005
From: artem at pavlenko.uklinux.net (Artem Pavlenko)
Date: Fri Nov  2 20:52:41 2007
Subject: [geos-devel] GEOS Exceptions
In-Reply-To: <20050420081346.GC88619@freek.keybit.net>
References: <20050418153411.GB74100@freek.keybit.net>	<1200950805041810094393d592@mail.gmail.com>	<20050418171148.GC75408@freek.keybit.net>	<426400D8.40001@pavlenko.uklinux.net>	<1200950805041813317b7d5a4d@mail.gmail.com>	<20050418231848.GA76581@freek.keybit.net>	<4264DFD7.5090804@pavlenko.uklinux.net>	<1200950805041911447c4eaf6d@mail.gmail.com>	<426555F1.2080808@pavlenko.uklinux.net>	<12009508050419135265cca4c2@mail.gmail.com>
	<20050420081346.GC88619@freek.keybit.net>
Message-ID: <42661323.90200@pavlenko.uklinux.net>

strk@refractions.net wrote:

>On Tue, Apr 19, 2005 at 04:52:12PM -0400, Mark Coletti wrote:
>  
>
>>On 4/19/05, Artem Pavlenko <artem@pavlenko.uklinux.net> wrote:
>>    
>>
>...
>  
>
>>>Meanwhile , could anyone explain to me why do we need
>>>vector<Coordinate>*  and not just vector<Coordinate>
>>>in DefaultCoordinateSequence? 
>>>      
>>>
>>Oh, my.  I hope it's not for some perverse form of vector re-sizing.
>>    
>>
>
>I found it like that and failed to clean it up as most of the current
>code. Changing - again - will break API.
>Actually I think we can really start a GEOS3 branch and do a big
>lifting on it.
>  
>
I'm up for it:-)

Have you heard anything from Dale Lutz?

>  
>
>>And again, why  not write:
>>    
>>
>>>   struct A
>>>  {
>>>      A(B const& b)
>>>        : b_(b) {}
>>>       B b_;
>>>  };
>>>      
>>>
>
>We can do this and I actually started doing it somewhere, but as far
>as args are pointers this doesn't really speed things up...
>  
>
True, but it is confusing. Lets make GEOS better platform!

Cheers
Artem

From strk at refractions.net  Wed Apr 20 04:50:01 2005
From: strk at refractions.net (strk@refractions.net)
Date: Fri Nov  2 20:52:41 2007
Subject: [geos-devel] GEOS<3>
In-Reply-To: <42661323.90200@pavlenko.uklinux.net>
References: <20050418171148.GC75408@freek.keybit.net>
	<426400D8.40001@pavlenko.uklinux.net>
	<1200950805041813317b7d5a4d@mail.gmail.com>
	<20050418231848.GA76581@freek.keybit.net>
	<4264DFD7.5090804@pavlenko.uklinux.net>
	<1200950805041911447c4eaf6d@mail.gmail.com>
	<426555F1.2080808@pavlenko.uklinux.net>
	<12009508050419135265cca4c2@mail.gmail.com>
	<20050420081346.GC88619@freek.keybit.net>
	<42661323.90200@pavlenko.uklinux.net>
Message-ID: <20050420085001.GG88619@freek.keybit.net>

On Wed, Apr 20, 2005 at 09:30:27AM +0100, Artem Pavlenko wrote:
> strk@refractions.net wrote:
> 
> >On Tue, Apr 19, 2005 at 04:52:12PM -0400, Mark Coletti wrote:
> > 
> >
> >>On 4/19/05, Artem Pavlenko <artem@pavlenko.uklinux.net> wrote:
> >>   
> >>
> >...
> > 
> >
> >>>Meanwhile , could anyone explain to me why do we need
> >>>vector<Coordinate>*  and not just vector<Coordinate>
> >>>in DefaultCoordinateSequence? 
> >>>     
> >>>
> >>Oh, my.  I hope it's not for some perverse form of vector re-sizing.
> >>   
> >>
> >
> >I found it like that and failed to clean it up as most of the current
> >code. Changing - again - will break API.
> >Actually I think we can really start a GEOS3 branch and do a big
> >lifting on it.
> > 
> >
> I'm up for it:-)
> 
> Have you heard anything from Dale Lutz?

He announced is going to send me the patches, some of which
are controversial (I think the CoordinateSequence ones, non-allowing
higher-dimensioned Coordinates) but compile-time definable.

For the GEOS<3> branch I'd first make a plan, as I belive the hard
thing with GEOS is keeping a stable ABI. The first change would be
some kind of ABI wrapper or similar thing ... but I don't know yet
how to do it. The only thing I imagined was a flat-namespaced C wrapper
like the one produced for JTS and the one implemented inside postgis.

I'm currently working on porting the WKB parser for specifically this
purpose.

> >>And again, why  not write:
> >>   
> >>
> >>>  struct A
> >>> {
> >>>     A(B const& b)
> >>>       : b_(b) {}
> >>>      B b_;
> >>> };
> >>>     
> >>>
> >
> >We can do this and I actually started doing it somewhere, but as far
> >as args are pointers this doesn't really speed things up...
> > 
> >
> True, but it is confusing. Lets make GEOS better platform!

Patches in this direction are accepted.

--strk;

> 
> Cheers
> Artem
> _______________________________________________
> geos-devel mailing list
> geos-devel@geos.refractions.net
> http://geos.refractions.net/mailman/listinfo/geos-devel

From strk at refractions.net  Wed Apr 20 06:14:32 2005
From: strk at refractions.net (strk@refractions.net)
Date: Fri Nov  2 20:52:41 2007
Subject: [geos-devel] WKB parser port
Message-ID: <20050420101432.GL88619@freek.keybit.net>

In the process of porting the WKB parser from JTS
to GEOS I encoutered one of the situation which in
the past have led to poor-performing code.

JTS WKBReader object uses an ByteOrderDataInStream
object to read a byte, an int, a long and a double.
The ByteOrderDataInStream object can be initialized
with an InStream object to set it's input source.
WKBReader object can also accept an InStream object
to initialize its internal ByteOrderDataInStream.

Now, for JTS InStream is an INTERFACE. 
This has been in the past ported to a virtual base
class.

My understanding of it is that it is intended to
be used to abstract reading from a memory buffer
and reading from a stream. Currently only reading
from a memory buffer is implemented using the
derived class ByteArrayInStream.

Is this a good candidate for templating ?
Shouldn't we use standard C++ templates for this ?
Would InStream really be an istream ?

Comments welcome.

--strk;

From artem at pavlenko.uklinux.net  Wed Apr 20 06:48:20 2005
From: artem at pavlenko.uklinux.net (Artem Pavlenko)
Date: Fri Nov  2 20:52:41 2007
Subject: [geos-devel] WKB parser port
In-Reply-To: <20050420101432.GL88619@freek.keybit.net>
References: <20050420101432.GL88619@freek.keybit.net>
Message-ID: <42663374.5000902@pavlenko.uklinux.net>

I don't know all the details, but sounds like a good idea,
I cannot think about any system that spits out WKB stream, but who knows?

template<typename IStream>
struct WKBReader
{  
        ByteOrderDataInStream<IStream> in;
};
  
Then IStream can be sstream, fstream etc.

Java-ish interfaces dont work well in c++:(

PS. I wonder how you're going to swap doubles. Macros?

>In the process of porting the WKB parser from JTS
>to GEOS I encoutered one of the situation which in
>the past have led to poor-performing code.
>
>JTS WKBReader object uses an ByteOrderDataInStream
>object to read a byte, an int, a long and a double.
>The ByteOrderDataInStream object can be initialized
>with an InStream object to set it's input source.
>WKBReader object can also accept an InStream object
>to initialize its internal ByteOrderDataInStream.
>
>Now, for JTS InStream is an INTERFACE. 
>This has been in the past ported to a virtual base
>class.
>
>My understanding of it is that it is intended to
>be used to abstract reading from a memory buffer
>and reading from a stream. Currently only reading
>from a memory buffer is implemented using the
>derived class ByteArrayInStream.
>
>Is this a good candidate for templating ?
>Shouldn't we use standard C++ templates for this ?
>Would InStream really be an istream ?
>
>Comments welcome.
>
>--strk;
>_______________________________________________
>geos-devel mailing list
>geos-devel@geos.refractions.net
>http://geos.refractions.net/mailman/listinfo/geos-devel
>
>
>  
>


From strk at refractions.net  Wed Apr 20 06:52:01 2005
From: strk at refractions.net (strk@refractions.net)
Date: Fri Nov  2 20:52:41 2007
Subject: [geos-devel] WKB parser port
In-Reply-To: <42663374.5000902@pavlenko.uklinux.net>
References: <20050420101432.GL88619@freek.keybit.net>
	<42663374.5000902@pavlenko.uklinux.net>
Message-ID: <20050420105201.GO88619@freek.keybit.net>

On Wed, Apr 20, 2005 at 11:48:20AM +0100, Artem Pavlenko wrote:
> I don't know all the details, but sounds like a good idea,
> I cannot think about any system that spits out WKB stream, but who knows?
> 
> template<typename IStream>
> struct WKBReader
> {  
>        ByteOrderDataInStream<IStream> in;
> };
>  
> Then IStream can be sstream, fstream etc.
> 
> Java-ish interfaces dont work well in c++:(
> 
> PS. I wonder how you're going to swap doubles. Macros?

JTS implementation *always* use byte_after_byte reads,
while I'm used to code swapping only when required, which
is faster if swapping is not required (postgis does it that
way). I think JTS way is due to FIXED byte order in the Java
world - am I right ?

--strk;

> 
> >In the process of porting the WKB parser from JTS
> >to GEOS I encoutered one of the situation which in
> >the past have led to poor-performing code.
> >
> >JTS WKBReader object uses an ByteOrderDataInStream
> >object to read a byte, an int, a long and a double.
> >The ByteOrderDataInStream object can be initialized
> >with an InStream object to set it's input source.
> >WKBReader object can also accept an InStream object
> >to initialize its internal ByteOrderDataInStream.
> >
> >Now, for JTS InStream is an INTERFACE. 
> >This has been in the past ported to a virtual base
> >class.
> >
> >My understanding of it is that it is intended to
> >be used to abstract reading from a memory buffer
> >and reading from a stream. Currently only reading
> >from a memory buffer is implemented using the
> >derived class ByteArrayInStream.
> >
> >Is this a good candidate for templating ?
> >Shouldn't we use standard C++ templates for this ?
> >Would InStream really be an istream ?
> >
> >Comments welcome.
> >
> >--strk;
> >_______________________________________________
> >geos-devel mailing list
> >geos-devel@geos.refractions.net
> >http://geos.refractions.net/mailman/listinfo/geos-devel
> >
> >
> > 
> >
> 
> _______________________________________________
> geos-devel mailing list
> geos-devel@geos.refractions.net
> http://geos.refractions.net/mailman/listinfo/geos-devel

From strk at refractions.net  Wed Apr 20 07:07:48 2005
From: strk at refractions.net (strk@refractions.net)
Date: Fri Nov  2 20:52:41 2007
Subject: [geos-devel] WKB parser port
In-Reply-To: <42663374.5000902@pavlenko.uklinux.net>
References: <20050420101432.GL88619@freek.keybit.net>
	<42663374.5000902@pavlenko.uklinux.net>
Message-ID: <20050420110748.GP88619@freek.keybit.net>

On Wed, Apr 20, 2005 at 11:48:20AM +0100, Artem Pavlenko wrote:
> I don't know all the details, but sounds like a good idea,
> I cannot think about any system that spits out WKB stream, but who knows?
> 
> template<typename IStream>
> struct WKBReader
> {  
>        ByteOrderDataInStream<IStream> in;
> };
>  
> Then IStream can be sstream, fstream etc.

I'll give a try to ByteOrderDataInStream class template
and report here for review.

--strk;

> 
> Java-ish interfaces dont work well in c++:(
> 
> PS. I wonder how you're going to swap doubles. Macros?
> 
> >In the process of porting the WKB parser from JTS
> >to GEOS I encoutered one of the situation which in
> >the past have led to poor-performing code.
> >
> >JTS WKBReader object uses an ByteOrderDataInStream
> >object to read a byte, an int, a long and a double.
> >The ByteOrderDataInStream object can be initialized
> >with an InStream object to set it's input source.
> >WKBReader object can also accept an InStream object
> >to initialize its internal ByteOrderDataInStream.
> >
> >Now, for JTS InStream is an INTERFACE. 
> >This has been in the past ported to a virtual base
> >class.
> >
> >My understanding of it is that it is intended to
> >be used to abstract reading from a memory buffer
> >and reading from a stream. Currently only reading
> >from a memory buffer is implemented using the
> >derived class ByteArrayInStream.
> >
> >Is this a good candidate for templating ?
> >Shouldn't we use standard C++ templates for this ?
> >Would InStream really be an istream ?
> >
> >Comments welcome.
> >
> >--strk;
> >_______________________________________________
> >geos-devel mailing list
> >geos-devel@geos.refractions.net
> >http://geos.refractions.net/mailman/listinfo/geos-devel
> >
> >
> > 
> >
> 
> _______________________________________________
> geos-devel mailing list
> geos-devel@geos.refractions.net
> http://geos.refractions.net/mailman/listinfo/geos-devel

From strk at refractions.net  Wed Apr 20 13:22:56 2005
From: strk at refractions.net (strk@refractions.net)
Date: Fri Nov  2 20:52:41 2007
Subject: [geos-devel] WKB parser templates, Safe patches, GEOS<3>
In-Reply-To: <20050420110748.GP88619@freek.keybit.net>
References: <20050420101432.GL88619@freek.keybit.net>
	<42663374.5000902@pavlenko.uklinux.net>
	<20050420110748.GP88619@freek.keybit.net>
Message-ID: <20050420172256.GY88619@freek.keybit.net>

On Wed, Apr 20, 2005 at 01:07:48PM +0200, strk@refractions.net wrote:
> On Wed, Apr 20, 2005 at 11:48:20AM +0100, Artem Pavlenko wrote:
> > I don't know all the details, but sounds like a good idea,
> > I cannot think about any system that spits out WKB stream, but who knows?
> > 
> > template<typename IStream>
> > struct WKBReader
> > {  
> >        ByteOrderDataInStream<IStream> in;
> > };
> >  
> > Then IStream can be sstream, fstream etc.
> 
> I'll give a try to ByteOrderDataInStream class template
> and report here for review.

As promised I've implemented the two templates and committed
them to CVS. The code can't currently work as the WKBReader
class requires a new interface on CoordinateSequence to take
higher-dimensioned Coordinate to be used.

You can review the template code at
source/headers/geos/WKBReaderT.h and
source/headers/geosByteOrderDataInStreamT.h

I used a 'T' prefix to allow for later typedefs to provide
a default implementation (ie. typedef WKBReaderT<istream> WKBReader).

Meanwhile I received the patches from Safe software, I'm going to
stop work on WKB parser for now and apply those patches, next I'd
approach the CoordinateSequence changes as introduced in JTS.

Again we might choose to use templates there as the big problem with
CoordinateSeuquence is that we can't inline due to virtual interface.

I really think this is matter for GEOS<3> branch and invite everyone
to express on this. I don't think we can keep current ABI porting new
JTS functionalities anyway...

--strk;

> 
> --strk;
> 
> > 
> > Java-ish interfaces dont work well in c++:(
> > 
> > PS. I wonder how you're going to swap doubles. Macros?
> > 
> > >In the process of porting the WKB parser from JTS
> > >to GEOS I encoutered one of the situation which in
> > >the past have led to poor-performing code.
> > >
> > >JTS WKBReader object uses an ByteOrderDataInStream
> > >object to read a byte, an int, a long and a double.
> > >The ByteOrderDataInStream object can be initialized
> > >with an InStream object to set it's input source.
> > >WKBReader object can also accept an InStream object
> > >to initialize its internal ByteOrderDataInStream.
> > >
> > >Now, for JTS InStream is an INTERFACE. 
> > >This has been in the past ported to a virtual base
> > >class.
> > >
> > >My understanding of it is that it is intended to
> > >be used to abstract reading from a memory buffer
> > >and reading from a stream. Currently only reading
> > >from a memory buffer is implemented using the
> > >derived class ByteArrayInStream.
> > >
> > >Is this a good candidate for templating ?
> > >Shouldn't we use standard C++ templates for this ?
> > >Would InStream really be an istream ?
> > >
> > >Comments welcome.
> > >
> > >--strk;
> > >_______________________________________________
> > >geos-devel mailing list
> > >geos-devel@geos.refractions.net
> > >http://geos.refractions.net/mailman/listinfo/geos-devel
> > >
> > >
> > > 
> > >
> > 
> > _______________________________________________
> > geos-devel mailing list
> > geos-devel@geos.refractions.net
> > http://geos.refractions.net/mailman/listinfo/geos-devel
> _______________________________________________
> geos-devel mailing list
> geos-devel@geos.refractions.net
> http://geos.refractions.net/mailman/listinfo/geos-devel

From pramsey at refractions.net  Wed Apr 20 14:23:15 2005
From: pramsey at refractions.net (Paul Ramsey)
Date: Fri Nov  2 20:52:41 2007
Subject: [geos-devel] GEOS<3>
In-Reply-To: <20050420085001.GG88619@freek.keybit.net>
References: <20050418171148.GC75408@freek.keybit.net>	<426400D8.40001@pavlenko.uklinux.net>	<1200950805041813317b7d5a4d@mail.gmail.com>	<20050418231848.GA76581@freek.keybit.net>	<4264DFD7.5090804@pavlenko.uklinux.net>	<1200950805041911447c4eaf6d@mail.gmail.com>	<426555F1.2080808@pavlenko.uklinux.net>	<12009508050419135265cca4c2@mail.gmail.com>	<20050420081346.GC88619@freek.keybit.net>	<42661323.90200@pavlenko.uklinux.net>
	<20050420085001.GG88619@freek.keybit.net>
Message-ID: <42669E13.9090500@refractions.net>

My main concern is that we are committing to break our ABI in the 
future, for sure, and that most/all of the new good work will end up in 
3, even though possibly much of it could be in 2. It's more of a 
care-and-concern thing. HEAD always gets all the love.

> He announced is going to send me the patches, some of which
> are controversial (I think the CoordinateSequence ones, non-allowing
> higher-dimensioned Coordinates) but compile-time definable.
> 
> For the GEOS<3> branch I'd first make a plan, as I belive the hard
> thing with GEOS is keeping a stable ABI. The first change would be
> some kind of ABI wrapper or similar thing ... but I don't know yet
> how to do it. The only thing I imagined was a flat-namespaced C wrapper
> like the one produced for JTS and the one implemented inside postgis.
o/geos-devel


From strk at refractions.net  Thu Apr 21 09:20:26 2005
From: strk at refractions.net (strk@refractions.net)
Date: Fri Nov  2 20:52:41 2007
Subject: [geos-devel] Re: GEOS Improvements from Safe
In-Reply-To: <28d4f419c507994d9ba92163a0ba204a@safe.com>
References: <VAN-E2K1Rc19yENX9pD00001104@VAN-E2K1.safe.internal>
	<425EBEA9.3010306@refractions.net>
	<28d4f419c507994d9ba92163a0ba204a@safe.com>
Message-ID: <20050421132026.GC7701@freek.keybit.net>

Graeme, thanks for your contribution.
Here are a few notes:

1) CGAlgorithms was no different from current CVS.

2) NonRobustCGAlgorithms is currently unused, like RobustCGAlgorithms
   we have a single CGAlgorithms being the robust implementation.
   I've removed the other two from the list of object compiled into
   the library.

3) The only applied patch was agains mergeZ() function, removing
   Coordinates copy. What remains are the 'controversial' ones.

I'd discuss the 'controversial' ones on geos-devel.
I think the Geomgraph change could be ported to JTS as well
while for the CoordinateSequence we should probably port
JTS changes, which allow higher dimensioned Coordinates.

If - as will probably be - we're going to work on GEOS3 we might
make the CoordinateSequence a template class allowing for functions
inlining still keeping the flexibility of using other Coordinate
implementations. This would require more analisys though. Applying
your patches now would work for an eventual 2.1.2 version of GEOS
altought I'm really not sure about ABI compatibility with 2.1.1...
should check it.

Finally.. do you have any performance test comparing runs
with OPTIMIZE_COORD_SEQUENCE_FOR_SPEED on and off ?

--strk;

On Wed, Apr 20, 2005 at 08:53:22AM -0700, Graeme Hiebert wrote:
> On 14 Apr, 2005, at 12:04, Paul Ramsey wrote: 
> 
> 
> > Thanks Dale, get it touch w/ Sandro when you're ready to go, 
> > Paul 
> > 
> > Dale Lutz wrote: 
> > 
> > > Hi Paul, 
> > > This is something Graeme (Hiebert) and I have to connect one, we 
> > > definitely 
> > > want to get this in right away.  Graeme is out this week at a 
> > > course until 
> > > Thursday, but it should be top of our list to get our 
> > > improvements your way 
> > > then. 
> > > Dale 
> > > 
> > 
>  
> Hi guys. 
> 
> I'm attaching a tarfile of the changes we made.  These are not 
> extensive by any means, but they make a tremendous difference in 
> performance for us.  (The reason it took so long to get them to you was 
> more of a resource contention issue than anything else - Dale and I 
> have just been too busy.) 
> 
> The set of .cpp changes is really completely orthogonal to the set of 
> .h changes.  The .cpp changes simply use some "const Coordinate &p" 
> variables in place of "Coordinate p" in a few places, to reduce 
> coordinates being copied. 
> 
> There are essentially two changes made to the .h files.  Each of these 
> is enabled by defining a macro in platform.h.  I've attached our own 
> platform.h as a sample, but I'll leave it up to you to fit this into 
> the existing GEOS autoconfigure framework. 
> 
> The first change, enabled with the OPTIMIZE_COORD_SEQUENCE_FOR_SPEED 
> macro, changes the way CoordinateSequence is defined.  Inline functions 
> are used instead of virtual functions in a few places.  This breaks the 
> ability to have subclasses with different kinds of coordinates, but 
> makes an amazing difference in performance. 
> 
> This change looks a little weird, because the DefaultCoordinateSequence 
> still exists, but its "vect" private member has been moved as a 
> protected member to CoordinateSequence.  It also still has non-inline 
> versions of the inline functions, but these will not normally be 
> called, because most (all?) calls to them are done through the 
> CoordinateSequence interface, which will instead get the inlines. 
> 
> The point_3d and PointCoordinateSequence classes are completely 
> disabled when this macro is defined, so that they are not accidentally 
> used.  Any code using a PointCoordinateSequence would implode if the 
> OPTIMIZE_COORD_SEQUENCE_FOR_SPEED macro was defined. 
> 
> The second change is enabled with the macro 
> ALLOW_GEOMETRYGRAPH_FOR_RELATE_SUBCLASS.  It is not nearly as useful to 
> most people, but it makes a big difference for the way some of our code 
> operates at Safe.  It just makes a couple of GeometryGraph's methods 
> virtual to allow us to make a subclass of GeometryGraph which is 
> suitable for performing Relate operations (though probably not for much 
> else).  Because we perform a series of relates against the same object, 
> this lets us precompute a GeometryGraph object and reuse it for 
> multiple calls to RelateComputer::computeMatrix() without crashing. 
> 
> I think that's everything.  Let me know if you have any questions. 
> 
>    -g 
> 

From strk at refractions.net  Thu Apr 21 11:04:28 2005
From: strk at refractions.net (strk@refractions.net)
Date: Fri Nov  2 20:52:41 2007
Subject: [geos-devel] ABI/API status and future development thougths
Message-ID: <20050421150428.GA9570@freek.keybit.net>


I just updated the NEWS file and made a simple
test to inspect compatibility between 2.1.1 and
current CVS.

Well, ABI is broken already. Probably due to
inlining of some functions aimed at improving
performance.

On the other hand, the part of API used by
postgis is still intact (ie. requires recompilation
but then works fine). Postgis uses about all of
Geometry methods and many CoordinateSequence methods.

With the help of ChangeLog I might attempt at taking
the ABI back to compatible with 2.1.1. That might allow
us to release a 2.1.2 slightly faster then 2.1.1 but not
significantly as inlines made the big difference.

Alternatively we can give the ABI break for granted and
go on with optimizzation continuing with inlines.

This is for ABI.

About API. Breaking that means you won't be able to build
old packages using GEOS using new relese of GEOS.
For example, postgis-1.0.0 won't be able to use a new GEOS
iff it will throw exceptions by ref instead of by pointers.
This is just an example, and is the wider one, as the GEOS
interface is pretty big and brokage can happen at different
levels of "deepness". For example current GEOS CVS has a
different interface on BufferSubgraph, but 'simple' clients
won't use BufferSubgraph directly, nor is its interface
documented (I had care to cut-down documentation specifically
for this purpose in previous releases). This means that simple
clients will continue to work with this change but more
complex ones will need to be modified to support new API and
introduce some kind of compile-time switch based on GEOS version
to support multiple GEOS interfaces.

Sorry if I'm being long and boring but I think having this written
helps everybody taking a decision. I'm bound to good quality but
I know the hassles of ever-changing interfaces (instability).

Whatever we decide to do I think a good approach would be providing
some form of simplified interface to GEOS for use by clients, aimed
at giving the hard-to-maintain stability of both API and ABI.
This could be a shared library shipped with GEOS and acting as
an 'adapter' between the always-moving GEOS lib and the client code
keeping the ->GEOS interface in sync with GEOS and the ->user interface
as stable as possible.

I've made a first implementation of such an adapter for JTS, providing
JTS access to C/C++ code in a stabler fashion (reduced API, abstract
datatype and garbage collector basically). I envision the GEOS
counterpart to follow that effort, althought garbage collection would be
harder to do (it's there for free with libgcj - the GNU java lib).

So what I'm saying is that next GEOS release could provide this wrapper
and client code willing to stop this annoyances could link against the
wrapper instead of against the main lib. One other advantages of this
would be that choice between GEOS and JTS would be a matter of a single
define to change function prefixes.

Implementation costs in this direction would be:

	- porting the WKB parser 
	- intergaring the boheme garbage collector

Enough noise, I hope someone will actually read this :P

Every contribution on the topic is highly apprieciated!

--strk;

From artem at pavlenko.uklinux.net  Thu Apr 21 12:12:16 2005
From: artem at pavlenko.uklinux.net (Artem Pavlenko)
Date: Fri Nov  2 20:52:41 2007
Subject: [geos-devel] ABI/API status and future development thougths
In-Reply-To: <20050421150428.GA9570@freek.keybit.net>
References: <20050421150428.GA9570@freek.keybit.net>
Message-ID: <4267D0E0.1030408@pavlenko.uklinux.net>

HI strk
Great to see GEOS is moving at last
I'll have a look at new changes over this weekend. I'm really into 
having GEOS3 as new effort, and maybe keep GEOS2 as a compatibility 
branch?.
It looks like *a lot* can be done even after you apply Dale's  patches. 
One thing that keeps popping out, is a different
'geometry models' in use, and it is a clearly  'slow-down' factor in 
GEOS (clients need to convert their geometries into geos ones and 
possibly back). There might be a smart way to address all that, but it 
will need radical changes. Shall we have a discussion about 'geometry 
model'? 

Anyway, good news!

Artem

strk@refractions.net wrote:

>I just updated the NEWS file and made a simple
>test to inspect compatibility between 2.1.1 and
>current CVS.
>
>Well, ABI is broken already. Probably due to
>inlining of some functions aimed at improving
>performance.
>
>On the other hand, the part of API used by
>postgis is still intact (ie. requires recompilation
>but then works fine). Postgis uses about all of
>Geometry methods and many CoordinateSequence methods.
>
>With the help of ChangeLog I might attempt at taking
>the ABI back to compatible with 2.1.1. That might allow
>us to release a 2.1.2 slightly faster then 2.1.1 but not
>significantly as inlines made the big difference.
>
>Alternatively we can give the ABI break for granted and
>go on with optimizzation continuing with inlines.
>
>This is for ABI.
>
>About API. Breaking that means you won't be able to build
>old packages using GEOS using new relese of GEOS.
>For example, postgis-1.0.0 won't be able to use a new GEOS
>iff it will throw exceptions by ref instead of by pointers.
>This is just an example, and is the wider one, as the GEOS
>interface is pretty big and brokage can happen at different
>levels of "deepness". For example current GEOS CVS has a
>different interface on BufferSubgraph, but 'simple' clients
>won't use BufferSubgraph directly, nor is its interface
>documented (I had care to cut-down documentation specifically
>for this purpose in previous releases). This means that simple
>clients will continue to work with this change but more
>complex ones will need to be modified to support new API and
>introduce some kind of compile-time switch based on GEOS version
>to support multiple GEOS interfaces.
>
>Sorry if I'm being long and boring but I think having this written
>helps everybody taking a decision. I'm bound to good quality but
>I know the hassles of ever-changing interfaces (instability).
>
>Whatever we decide to do I think a good approach would be providing
>some form of simplified interface to GEOS for use by clients, aimed
>at giving the hard-to-maintain stability of both API and ABI.
>This could be a shared library shipped with GEOS and acting as
>an 'adapter' between the always-moving GEOS lib and the client code
>keeping the ->GEOS interface in sync with GEOS and the ->user interface
>as stable as possible.
>
>I've made a first implementation of such an adapter for JTS, providing
>JTS access to C/C++ code in a stabler fashion (reduced API, abstract
>datatype and garbage collector basically). I envision the GEOS
>counterpart to follow that effort, althought garbage collection would be
>harder to do (it's there for free with libgcj - the GNU java lib).
>
>So what I'm saying is that next GEOS release could provide this wrapper
>and client code willing to stop this annoyances could link against the
>wrapper instead of against the main lib. One other advantages of this
>would be that choice between GEOS and JTS would be a matter of a single
>define to change function prefixes.
>
>Implementation costs in this direction would be:
>
>	- porting the WKB parser 
>	- intergaring the boheme garbage collector
>
>Enough noise, I hope someone will actually read this :P
>
>Every contribution on the topic is highly apprieciated!
>
>--strk;
>_______________________________________________
>geos-devel mailing list
>geos-devel@geos.refractions.net
>http://geos.refractions.net/mailman/listinfo/geos-devel
>
>
>  
>


From strk at refractions.net  Thu Apr 21 12:19:03 2005
From: strk at refractions.net (strk@refractions.net)
Date: Fri Nov  2 20:52:41 2007
Subject: [geos-devel] ABI/API status and future development thougths
In-Reply-To: <4267D0E0.1030408@pavlenko.uklinux.net>
References: <20050421150428.GA9570@freek.keybit.net>
	<4267D0E0.1030408@pavlenko.uklinux.net>
Message-ID: <20050421161903.GA10406@freek.keybit.net>

On Thu, Apr 21, 2005 at 05:12:16PM +0100, Artem Pavlenko wrote:
> HI strk
> Great to see GEOS is moving at last
> I'll have a look at new changes over this weekend. I'm really into 
> having GEOS3 as new effort, and maybe keep GEOS2 as a compatibility 
> branch?.
> It looks like *a lot* can be done even after you apply Dale's  patches. 
> One thing that keeps popping out, is a different
> 'geometry models' in use, and it is a clearly  'slow-down' factor in 
> GEOS (clients need to convert their geometries into geos ones and 
> possibly back). There might be a smart way to address all that, but it 
> will need radical changes. Shall we have a discussion about 'geometry 
> model'? 

If you have a "smart way" handy why not ? 
We are at a storming phase anyway.
--strk;

> 
> Anyway, good news!
> 
> Artem
> 
> strk@refractions.net wrote:
> 
> >I just updated the NEWS file and made a simple
> >test to inspect compatibility between 2.1.1 and
> >current CVS.
> >
> >Well, ABI is broken already. Probably due to
> >inlining of some functions aimed at improving
> >performance.
> >
> >On the other hand, the part of API used by
> >postgis is still intact (ie. requires recompilation
> >but then works fine). Postgis uses about all of
> >Geometry methods and many CoordinateSequence methods.
> >
> >With the help of ChangeLog I might attempt at taking
> >the ABI back to compatible with 2.1.1. That might allow
> >us to release a 2.1.2 slightly faster then 2.1.1 but not
> >significantly as inlines made the big difference.
> >
> >Alternatively we can give the ABI break for granted and
> >go on with optimizzation continuing with inlines.
> >
> >This is for ABI.
> >
> >About API. Breaking that means you won't be able to build
> >old packages using GEOS using new relese of GEOS.
> >For example, postgis-1.0.0 won't be able to use a new GEOS
> >iff it will throw exceptions by ref instead of by pointers.
> >This is just an example, and is the wider one, as the GEOS
> >interface is pretty big and brokage can happen at different
> >levels of "deepness". For example current GEOS CVS has a
> >different interface on BufferSubgraph, but 'simple' clients
> >won't use BufferSubgraph directly, nor is its interface
> >documented (I had care to cut-down documentation specifically
> >for this purpose in previous releases). This means that simple
> >clients will continue to work with this change but more
> >complex ones will need to be modified to support new API and
> >introduce some kind of compile-time switch based on GEOS version
> >to support multiple GEOS interfaces.
> >
> >Sorry if I'm being long and boring but I think having this written
> >helps everybody taking a decision. I'm bound to good quality but
> >I know the hassles of ever-changing interfaces (instability).
> >
> >Whatever we decide to do I think a good approach would be providing
> >some form of simplified interface to GEOS for use by clients, aimed
> >at giving the hard-to-maintain stability of both API and ABI.
> >This could be a shared library shipped with GEOS and acting as
> >an 'adapter' between the always-moving GEOS lib and the client code
> >keeping the ->GEOS interface in sync with GEOS and the ->user interface
> >as stable as possible.
> >
> >I've made a first implementation of such an adapter for JTS, providing
> >JTS access to C/C++ code in a stabler fashion (reduced API, abstract
> >datatype and garbage collector basically). I envision the GEOS
> >counterpart to follow that effort, althought garbage collection would be
> >harder to do (it's there for free with libgcj - the GNU java lib).
> >
> >So what I'm saying is that next GEOS release could provide this wrapper
> >and client code willing to stop this annoyances could link against the
> >wrapper instead of against the main lib. One other advantages of this
> >would be that choice between GEOS and JTS would be a matter of a single
> >define to change function prefixes.
> >
> >Implementation costs in this direction would be:
> >
> >	- porting the WKB parser 
> >	- intergaring the boheme garbage collector
> >
> >Enough noise, I hope someone will actually read this :P
> >
> >Every contribution on the topic is highly apprieciated!
> >
> >--strk;
> >_______________________________________________
> >geos-devel mailing list
> >geos-devel@geos.refractions.net
> >http://geos.refractions.net/mailman/listinfo/geos-devel
> >
> >
> > 
> >
> 
> _______________________________________________
> geos-devel mailing list
> geos-devel@geos.refractions.net
> http://geos.refractions.net/mailman/listinfo/geos-devel

From fwarmerdam at gmail.com  Thu Apr 21 12:15:59 2005
From: fwarmerdam at gmail.com (Frank Warmerdam)
Date: Fri Nov  2 20:52:41 2007
Subject: [geos-devel] ABI/API status and future development thougths
In-Reply-To: <20050421150428.GA9570@freek.keybit.net>
References: <20050421150428.GA9570@freek.keybit.net>
Message-ID: <931f8ea9050421091552ddb90e@mail.gmail.com>

On 4/21/05, strk@refractions.net <strk@refractions.net> wrote:
> Enough noise, I hope someone will actually read this :P
> 
> Every contribution on the topic is highly apprieciated!

Strk,

I am in favour of having a relatively simple stable part of the API 
that should even be ABI compatible over long periods of time.

However, as noted earlier, I am generally most concerned
about API changes that make builds harder. Hence my resistance
to the exception improvement.  I don't think you should sweat
about ABI changes related to inlining and so forth, though it would
be nice if they could easily be prevented. 

PS. In GDAL I have a C API which I make a substantial effort
to keep ABI compatible over the long term but at the C++ level
I make no effort to retain ABI compatibilty, but I do try to keep
API (ie. source/build level) compatibility as best I can. 

Best regards,
-- 
---------------------------------------+--------------------------------------
I set the clouds in motion - turn up   | Frank Warmerdam, warmerdam@pobox.com
light and sound - activate the windows | http://pobox.com/~warmerdam
and watch the world go round - Rush    | Geospatial Programmer for Rent

From tmacy at mapshots.com  Thu Apr 21 12:27:26 2005
From: tmacy at mapshots.com (Ted Macy)
Date: Fri Nov  2 20:52:41 2007
Subject: [geos-devel] ABI/API status and future development thougths
In-Reply-To: <4267D0E0.1030408@pavlenko.uklinux.net>
Message-ID: <20050421122493.SM02020@mobiledog>

Can I get a candid assessment here?   I'm new to GEOS.  And you guys are
scaring me off from wanting to use it.  Here is my situation:

I normally use the Cadcorp or Tatuk COM objects for our production work
(using the published OGIS Simple Feature COM Interfaces).  However we have
some public domain stuff that we share with the agriculture industry, and I
cannot make other users license the components from these vendors.  I needed
a COM compatible set of objects that that could be plugged in as an
alternative to these two commercial options, and they would only convey
geometry data between objects through a "Stable" API :).   Two years ago, I
contracted a developer to implement a COM object using C++ that would
implement the OGIS Simple Features COM interface specification.  The
implementation only knew about WKT parsing and regeneration.  It had no
other spatial functionality... buffering, intersection, etc.  

Now, I need my COM objects to implement some true spatial functionality.  I
thought I might contract a developer to set my COM wrappers on top of the
GEOS codebase and be good to go with a stand-alone set of COM-based geometry
objects.  But all of this talk about breaking compatibility, performance,
etc, etc... it is scaring me.   I don't write C++ code... I'm a C programmer
and a power VB COM programmer.  I have to contract this project out.  Can I
expect that the GEOS stuff is in a suitable state to make this project a
reality?

And, by the way... when done, I was planning to contribute the full COM
implementation back to the community if anyone was interested in it.

Thanks.
Ted Macy 



From chodgson at refractions.net  Thu Apr 21 13:26:30 2005
From: chodgson at refractions.net (Chris Hodgson)
Date: Fri Nov  2 20:52:41 2007
Subject: [geos-devel] ABI/API status and future development thougths
In-Reply-To: <20050421150428.GA9570@freek.keybit.net>
References: <20050421150428.GA9570@freek.keybit.net>
Message-ID: <4267E246.1070904@refractions.net>

Strk, here's my input for you...

It seems like every change that anyone wants to make right now is going 
to break ABI, so I say start a new branch, and stop worrying about it.

You have already identified the best way to prevent further ABI breakage 
- the "compatibility layer", and switching everything over to using it 
will effectively be an API breakage - so you might as well fit the other 
API-breaking changes into the same branch (exception throwing, etc.). If 
you plan these changes carefully, it should be possible to limit future 
API breakage, perhaps by adding new/alternative functions instead of 
replacing/breaking existing ones.

You might also want to think about what exactly the goals of GEOS are - 
to continue to mirror JTS development, or to move away from the Java 
roots and into a more optimized C++ implementation? I think that since 
there now exists the GJC option for a direct JTS-to-C-compatible 
compilation option, it makes more sense for GEOS to work towards being 
more optimized for C++, while still sharing algorithm changes 
back-and-forth with JTS.

I hope that's useful input...
Chris

strk@refractions.net wrote:

>I just updated the NEWS file and made a simple
>test to inspect compatibility between 2.1.1 and
>current CVS.
>
>Well, ABI is broken already. Probably due to
>inlining of some functions aimed at improving
>performance.
>
>On the other hand, the part of API used by
>postgis is still intact (ie. requires recompilation
>but then works fine). Postgis uses about all of
>Geometry methods and many CoordinateSequence methods.
>
>With the help of ChangeLog I might attempt at taking
>the ABI back to compatible with 2.1.1. That might allow
>us to release a 2.1.2 slightly faster then 2.1.1 but not
>significantly as inlines made the big difference.
>
>Alternatively we can give the ABI break for granted and
>go on with optimizzation continuing with inlines.
>
>This is for ABI.
>
>About API. Breaking that means you won't be able to build
>old packages using GEOS using new relese of GEOS.
>For example, postgis-1.0.0 won't be able to use a new GEOS
>iff it will throw exceptions by ref instead of by pointers.
>This is just an example, and is the wider one, as the GEOS
>interface is pretty big and brokage can happen at different
>levels of "deepness". For example current GEOS CVS has a
>different interface on BufferSubgraph, but 'simple' clients
>won't use BufferSubgraph directly, nor is its interface
>documented (I had care to cut-down documentation specifically
>for this purpose in previous releases). This means that simple
>clients will continue to work with this change but more
>complex ones will need to be modified to support new API and
>introduce some kind of compile-time switch based on GEOS version
>to support multiple GEOS interfaces.
>
>Sorry if I'm being long and boring but I think having this written
>helps everybody taking a decision. I'm bound to good quality but
>I know the hassles of ever-changing interfaces (instability).
>
>Whatever we decide to do I think a good approach would be providing
>some form of simplified interface to GEOS for use by clients, aimed
>at giving the hard-to-maintain stability of both API and ABI.
>This could be a shared library shipped with GEOS and acting as
>an 'adapter' between the always-moving GEOS lib and the client code
>keeping the ->GEOS interface in sync with GEOS and the ->user interface
>as stable as possible.
>
>I've made a first implementation of such an adapter for JTS, providing
>JTS access to C/C++ code in a stabler fashion (reduced API, abstract
>datatype and garbage collector basically). I envision the GEOS
>counterpart to follow that effort, althought garbage collection would be
>harder to do (it's there for free with libgcj - the GNU java lib).
>
>So what I'm saying is that next GEOS release could provide this wrapper
>and client code willing to stop this annoyances could link against the
>wrapper instead of against the main lib. One other advantages of this
>would be that choice between GEOS and JTS would be a matter of a single
>define to change function prefixes.
>
>Implementation costs in this direction would be:
>
>	- porting the WKB parser 
>	- intergaring the boheme garbage collector
>
>Enough noise, I hope someone will actually read this :P
>
>Every contribution on the topic is highly apprieciated!
>
>--strk;
>_______________________________________________
>geos-devel mailing list
>geos-devel@geos.refractions.net
>http://geos.refractions.net/mailman/listinfo/geos-devel
>  
>


From niki.spahiev at gmail.com  Fri Apr 22 06:23:52 2005
From: niki.spahiev at gmail.com (Niki Spahiev)
Date: Fri Nov  2 20:52:41 2007
Subject: [geos-devel] ABI/API status and future development thougths
In-Reply-To: <20050421150428.GA9570@freek.keybit.net>
References: <20050421150428.GA9570@freek.keybit.net>
Message-ID: <67c2293205042203235ac499f2@mail.gmail.com>

> Enough noise, I hope someone will actually read this :P
> 
> Every contribution on the topic is highly apprieciated!

For all python users (me :) ABI is not concern. I prefer quality and
speed over API stability. If i can't use code due to poor quality or
speed stability has no effect.

Niki Spahiev

From strk at refractions.net  Fri Apr 22 07:25:52 2005
From: strk at refractions.net (strk@refractions.net)
Date: Fri Nov  2 20:52:41 2007
Subject: [geos-devel] ABI/API status and future development thougths
In-Reply-To: <4267E246.1070904@refractions.net>
References: <20050421150428.GA9570@freek.keybit.net>
	<4267E246.1070904@refractions.net>
Message-ID: <20050422112552.GB17193@freek.keybit.net>

On Thu, Apr 21, 2005 at 10:26:30AM -0700, Chris Hodgson wrote:
> Strk, here's my input for you...
> 
> It seems like every change that anyone wants to make right now is going 
> to break ABI, so I say start a new branch, and stop worrying about it.

ABI is gone already. But I do can stop worrying ;)

> You have already identified the best way to prevent further ABI breakage 
> - the "compatibility layer", and switching everything over to using it 
> will effectively be an API breakage - so you might as well fit the other 
> API-breaking changes into the same branch (exception throwing, etc.). If 
> you plan these changes carefully, it should be possible to limit future 
> API breakage, perhaps by adding new/alternative functions instead of 
> replacing/breaking existing ones.

I disagree on this, as people not willing to jump on the wrapper
can just recompile their client code w/out big hassles (it would
be nice to have some feedback on this with current CVS as some
inner classes changed API but none of the ones accessible including
geos.h). If we change exceptions - for example - postgis-1.0.0 won't
be able to show GEOS3 exception messages (but postgis-1.0.1 might - see
below).

> You might also want to think about what exactly the goals of GEOS are - 
> to continue to mirror JTS development, or to move away from the Java 
> roots and into a more optimized C++ implementation? I think that since 
> there now exists the GJC option for a direct JTS-to-C-compatible 
> compilation option, it makes more sense for GEOS to work towards being 
> more optimized for C++, while still sharing algorithm changes 
> back-and-forth with JTS.

I think this can be done breaking ABI and growing API.

> I hope that's useful input...

Yes! Thanks.

I'm currently working on porting the WKB parser from JTS.
That would be a step toward the "compatibility layer" with
long lived ABI. Target for next geos release (3.0.0) will
be mailny providing API-near-compatible performance
improvements and possibly the layer (but it depends on
time constraints wheter the latter will be possible - mainly
due to garbage collection).

The exception change is still on the plate. Just a couple of
explanatory words on the topic:

Resource limits hit conditions will still be thrown by the standard
c++ library, so client code willing to catch both standard library
AND geos exceptions would do something like:

	catch(GEOSException *e)
	{
		//print e->toString();
		delete e;
	}
	catch(std::exception &e)
	{
		//print e
	}

Making GEOSException derive from std::exception and thrown by
reference would be cought by the second block and client code
considering both would keep working (unless they do anything
special with GEOSExceptions other then printing them).

A side note: PostGIS up to 1.0.0 catches standard exceptions
cleanly but does not print them, which will hide exceptions from
GEOS in case of a switch. PostGIS 1.0.1 might easily make 
this possible, but older versions are out of reach.

Thanks also to Frank for his contribution,
I really appreciated it!

--strk;

> Chris
> 
> strk@refractions.net wrote:
> 
> >I just updated the NEWS file and made a simple
> >test to inspect compatibility between 2.1.1 and
> >current CVS.
> >
> >Well, ABI is broken already. Probably due to
> >inlining of some functions aimed at improving
> >performance.
> >
> >On the other hand, the part of API used by
> >postgis is still intact (ie. requires recompilation
> >but then works fine). Postgis uses about all of
> >Geometry methods and many CoordinateSequence methods.
> >
> >With the help of ChangeLog I might attempt at taking
> >the ABI back to compatible with 2.1.1. That might allow
> >us to release a 2.1.2 slightly faster then 2.1.1 but not
> >significantly as inlines made the big difference.
> >
> >Alternatively we can give the ABI break for granted and
> >go on with optimizzation continuing with inlines.
> >
> >This is for ABI.
> >
> >About API. Breaking that means you won't be able to build
> >old packages using GEOS using new relese of GEOS.
> >For example, postgis-1.0.0 won't be able to use a new GEOS
> >iff it will throw exceptions by ref instead of by pointers.
> >This is just an example, and is the wider one, as the GEOS
> >interface is pretty big and brokage can happen at different
> >levels of "deepness". For example current GEOS CVS has a
> >different interface on BufferSubgraph, but 'simple' clients
> >won't use BufferSubgraph directly, nor is its interface
> >documented (I had care to cut-down documentation specifically
> >for this purpose in previous releases). This means that simple
> >clients will continue to work with this change but more
> >complex ones will need to be modified to support new API and
> >introduce some kind of compile-time switch based on GEOS version
> >to support multiple GEOS interfaces.
> >
> >Sorry if I'm being long and boring but I think having this written
> >helps everybody taking a decision. I'm bound to good quality but
> >I know the hassles of ever-changing interfaces (instability).
> >
> >Whatever we decide to do I think a good approach would be providing
> >some form of simplified interface to GEOS for use by clients, aimed
> >at giving the hard-to-maintain stability of both API and ABI.
> >This could be a shared library shipped with GEOS and acting as
> >an 'adapter' between the always-moving GEOS lib and the client code
> >keeping the ->GEOS interface in sync with GEOS and the ->user interface
> >as stable as possible.
> >
> >I've made a first implementation of such an adapter for JTS, providing
> >JTS access to C/C++ code in a stabler fashion (reduced API, abstract
> >datatype and garbage collector basically). I envision the GEOS
> >counterpart to follow that effort, althought garbage collection would be
> >harder to do (it's there for free with libgcj - the GNU java lib).
> >
> >So what I'm saying is that next GEOS release could provide this wrapper
> >and client code willing to stop this annoyances could link against the
> >wrapper instead of against the main lib. One other advantages of this
> >would be that choice between GEOS and JTS would be a matter of a single
> >define to change function prefixes.
> >
> >Implementation costs in this direction would be:
> >
> >	- porting the WKB parser 
> >	- intergaring the boheme garbage collector
> >
> >Enough noise, I hope someone will actually read this :P
> >
> >Every contribution on the topic is highly apprieciated!
> >
> >--strk;
> >_______________________________________________
> >geos-devel mailing list
> >geos-devel@geos.refractions.net
> >http://geos.refractions.net/mailman/listinfo/geos-devel
> > 
> >
> 
> _______________________________________________
> geos-devel mailing list
> geos-devel@geos.refractions.net
> http://geos.refractions.net/mailman/listinfo/geos-devel

From strk at refractions.net  Fri Apr 22 07:27:12 2005
From: strk at refractions.net (strk@refractions.net)
Date: Fri Nov  2 20:52:41 2007
Subject: [geos-devel] ABI/API status and future development thougths
In-Reply-To: <67c2293205042203235ac499f2@mail.gmail.com>
References: <20050421150428.GA9570@freek.keybit.net>
	<67c2293205042203235ac499f2@mail.gmail.com>
Message-ID: <20050422112712.GC17193@freek.keybit.net>

On Fri, Apr 22, 2005 at 01:23:52PM +0300, Niki Spahiev wrote:
> > Enough noise, I hope someone will actually read this :P
> > 
> > Every contribution on the topic is highly apprieciated!
> 
> For all python users (me :) ABI is not concern. I prefer quality and
> speed over API stability. If i can't use code due to poor quality or
> speed stability has no effect.

Note that ABI and ABI are two different things.
A change in GEOS API would probably mean a change in python API
as well, while python code would be immune from ABI changes.
(sorry if I'm saying banalities).

--strk;

> 
> Niki Spahiev
> _______________________________________________
> geos-devel mailing list
> geos-devel@geos.refractions.net
> http://geos.refractions.net/mailman/listinfo/geos-devel

From strk at refractions.net  Mon Apr 25 05:07:02 2005
From: strk at refractions.net (strk@refractions.net)
Date: Fri Nov  2 20:52:41 2007
Subject: [geos-devel] ABI/API status and future development thougths
In-Reply-To: <20050421122493.SM02020@mobiledog>
References: <4267D0E0.1030408@pavlenko.uklinux.net>
	<20050421122493.SM02020@mobiledog>
Message-ID: <20050425090702.GC47389@freek.keybit.net>

On Thu, Apr 21, 2005 at 12:27:26PM -0400, Ted Macy wrote:
> Can I get a candid assessment here?   I'm new to GEOS.  And you guys are
> scaring me off from wanting to use it.  Here is my situation:

Your scare is an effect of people here being
sincere, as opposite to proprietary software vendors.

> I normally use the Cadcorp or Tatuk COM objects for our production work
> (using the published OGIS Simple Feature COM Interfaces).  However we have
> some public domain stuff that we share with the agriculture industry, and I
> cannot make other users license the components from these vendors.  I needed
> a COM compatible set of objects that that could be plugged in as an
> alternative to these two commercial options, and they would only convey
> geometry data between objects through a "Stable" API :).   Two years ago, I
> contracted a developer to implement a COM object using C++ that would
> implement the OGIS Simple Features COM interface specification.  The
> implementation only knew about WKT parsing and regeneration.  It had no
> other spatial functionality... buffering, intersection, etc.  
> 
> Now, I need my COM objects to implement some true spatial functionality.  I
> thought I might contract a developer to set my COM wrappers on top of the
> GEOS codebase and be good to go with a stand-alone set of COM-based geometry
> objects.  But all of this talk about breaking compatibility, performance,
> etc, etc... it is scaring me.   I don't write C++ code... I'm a C programmer
> and a power VB COM programmer.  I have to contract this project out.  Can I
> expect that the GEOS stuff is in a suitable state to make this project a
> reality?

It surely is, making wrappers is exactly the way I was suggesting to
obtain a stable API. I planned to do similar thing for C/C++ code.
GEOS already has a python interface with same abstraction
charateristics. This would be the COM interface.

> And, by the way... when done, I was planning to contribute the full COM
> implementation back to the community if anyone was interested in it.

This would be the best investiment in stability, which means whatever
will happen to GEOS maintainence of wrappers would be easier if shared.

--strk;

> 
> Thanks.
> Ted Macy 
> 
> 
> _______________________________________________
> geos-devel mailing list
> geos-devel@geos.refractions.net
> http://geos.refractions.net/mailman/listinfo/geos-devel

From niki.spahiev at gmail.com  Mon Apr 25 07:15:31 2005
From: niki.spahiev at gmail.com (Niki Spahiev)
Date: Fri Nov  2 20:52:41 2007
Subject: [geos-devel] ABI/API status and future development thougths
In-Reply-To: <20050422112712.GC17193@freek.keybit.net>
References: <20050421150428.GA9570@freek.keybit.net>
	<67c2293205042203235ac499f2@mail.gmail.com>
	<20050422112712.GC17193@freek.keybit.net>
Message-ID: <67c22932050425041529365046@mail.gmail.com>

> > For all python users (me :) ABI is not concern. I prefer quality and
> > speed over API stability. If i can't use code due to poor quality or
> > speed stability has no effect.
> 
> Note that ABI and ABI are two different things.
> A change in GEOS API would probably mean a change in python API
> as well, while python code would be immune from ABI changes.
> (sorry if I'm saying banalities).

I prefer to live with API changes if they mean better code.

Niki Spahiev

P.S. English is not my native language

From tmacy at mapshots.com  Mon Apr 25 07:53:12 2005
From: tmacy at mapshots.com (Ted Macy)
Date: Fri Nov  2 20:52:41 2007
Subject: [geos-devel] ABI/API status and future development thougths
In-Reply-To: <20050425090702.GC47389@freek.keybit.net>
Message-ID: <200504250752413.SM02020@mobiledog>


>From strk:

>Your scare is an effect of people here being
>sincere, as opposite to proprietary software vendors.

Personally, I believe that I am fortunate enough to do business with quite a
few "sincere" proprietary vendors, and I hope that my customers feel the
same way about me.  But I think I understand what you were trying to say.





From jingping.xie at jicoux.com  Tue Apr 26 03:20:25 2005
From: jingping.xie at jicoux.com (jingping.xie)
Date: Fri Nov  2 20:52:41 2007
Subject: [geos-devel] why this exception  happened
Message-ID: <002401c54a30$6b67d660$0c08a8c0@jingpingxie>

All

When I make two polygon booled operation for example union operation, 
somtimes one exception happened.

the two polygon is all valid, I think it shouldn't get a excetion if I union 
two polygon anyway.

Why it happened and how to solve it?



the following is test.xml written by me:

<run>
  <precisionModel type="FLOATING" />
<case>
  <desc>A/A-3-2-1: two polygons touching at multiple points 
[dim(0){A.A.Bdy.CP = B.A.Bdy.CP}, dim(0){A.A.Bdy.V = B.A.Bdy.V}]</desc>
  <a>POLYGON( (-40489.278096372727 4372.207298020518,-40296.371428571423 
4384.328571428571,-40288.871021184132 4292.242313959804,-40473.478571428568 
4280.385714285714,-40489.278096372727 4372.207298020518))</a>
  <b>POLYGON( (-40539.639285714278 4369.042857142857,-40372.370476402626 
4379.553177980468,-40369.146156502444 4148.052935215692,-40519.282142857141 
4149.947619047619,-40539.639285714278 4369.042857142857))</b>
<test>
  <op name="union" arg1="A" arg2="B" arg3="FF2F01212">true</op>
  </test>
  </case>
</run>

this is the exception message:

Exception: TopologyException: no outgoing dirEdge found 
(-40539.6,4369.04,1.7e-3
08)

thanks
jingping xie
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.osgeo.org/pipermail/geos-devel/attachments/20050426/bc4e3603/attachment.html
From strk at refractions.net  Tue Apr 26 04:57:44 2005
From: strk at refractions.net (strk@refractions.net)
Date: Fri Nov  2 20:52:41 2007
Subject: [geos-devel] why this exception  happened
In-Reply-To: <002401c54a30$6b67d660$0c08a8c0@jingpingxie>
References: <002401c54a30$6b67d660$0c08a8c0@jingpingxie>
Message-ID: <20050426085744.GB55314@freek.keybit.net>

Xie, I tried with current CVS and the exception is not thrown.
What version are you using ?
--strk;

On Tue, Apr 26, 2005 at 04:20:25PM +0900, jingping.xie wrote:
> All
> 
> When I make two polygon booled operation for example union operation, 
> somtimes one exception happened.
> 
> the two polygon is all valid, I think it shouldn't get a excetion if I union 
> two polygon anyway.
> 
> Why it happened and how to solve it?
> 
> 
> 
> the following is test.xml written by me:
> 
> <run>
>   <precisionModel type="FLOATING" />
> <case>
>   <desc>A/A-3-2-1: two polygons touching at multiple points 
> [dim(0){A.A.Bdy.CP = B.A.Bdy.CP}, dim(0){A.A.Bdy.V = B.A.Bdy.V}]</desc>
>   <a>POLYGON( (-40489.278096372727 4372.207298020518,-40296.371428571423 
> 4384.328571428571,-40288.871021184132 4292.242313959804,-40473.478571428568 
> 4280.385714285714,-40489.278096372727 4372.207298020518))</a>
>   <b>POLYGON( (-40539.639285714278 4369.042857142857,-40372.370476402626 
> 4379.553177980468,-40369.146156502444 4148.052935215692,-40519.282142857141 
> 4149.947619047619,-40539.639285714278 4369.042857142857))</b>
> <test>
>   <op name="union" arg1="A" arg2="B" arg3="FF2F01212">true</op>
>   </test>
>   </case>
> </run>
> 
> this is the exception message:
> 
> Exception: TopologyException: no outgoing dirEdge found 
> (-40539.6,4369.04,1.7e-3
> 08)
> 
> thanks
> jingping xie

> _______________________________________________
> geos-devel mailing list
> geos-devel@geos.refractions.net
> http://geos.refractions.net/mailman/listinfo/geos-devel


From jingping.xie at jicoux.com  Tue Apr 26 22:19:55 2005
From: jingping.xie at jicoux.com (jingping.xie)
Date: Fri Nov  2 20:52:41 2007
Subject: [geos-devel] Re: why this exception  happened
Message-ID: <001901c54acf$9b4986e0$0c08a8c0@jingpingxie>

Skipped content of type multipart/alternative-------------- next part --------------
A non-text attachment was scrubbed...
Name: geos-2.1.1.rar
Type: application/octet-stream
Size: 1054260 bytes
Desc: not available
Url : http://lists.osgeo.org/pipermail/geos-devel/attachments/20050427/2de89e13/geos-2.1.1.obj
From jingping.xie at jicoux.com  Tue Apr 26 22:25:38 2005
From: jingping.xie at jicoux.com (jingping.xie)
Date: Fri Nov  2 20:52:41 2007
Subject: [geos-devel] Re: why this exception  happened
Message-ID: <003701c54ad0$673819b0$0c08a8c0@jingpingxie>

Thanks a lot,,strk.

I compiled the veriosn of "[2004/12/16] geos-2.1.1.tar.bz2" with 
VisualStudio.

and it got complie error, so I  made the following change.

$B-!(Bchange the file name of "source\headers\geos\platform.h.vc" to 
"source\headers\geos\platform.h",
"source\headers\geos\version.h.in" to "source\headers\geos\version.h".

$B-"(Bdownload "Stackwalker.h","Stackwalker.cpp" from www.codeproject.com , then 
add them to the folder of "\source\test"

$B-#(Bremove the following files from solution
remove 
"BasicCoordinateList.cpp","CoordinateList.cpp","CoordinateListFactory.cpp","PointCoordinateList.cpp" 
from "Source File\geom\"
remove "CPCLException.cpp","CustomPointCoordinateList.cpp" from "Source 
File\examples\"

$B-$(Badd the following files to solution
add "Profiler.cpp" to "Source Files\util"
add 
"CoordinateSequenceFactory.cpp","DefaultCoordinateSequenceFactory.cpp","DefaultCoordinateSequence.cpp","CoordinateSequence.cpp" 
to "Source Files\geom"

add 
"ElevationMatrix.cpp","ElevationMatrixCell.cpp","ElevationMatrixFilter.cpp" 
to "Source Files\geom\operation\overlay"

that's all
jingping xie



>Xie, I tried with current CVS and the exception is not thrown.
>What version are you using ?
>--strk;

>On Tue, Apr 26, 2005 at 04:20:25PM +0900, jingping.xie wrote:
>> All
>>
>> When I make two polygon booled operation for example union operation,
>> somtimes one exception happened.
>>
>> the two polygon is all valid, I think it shouldn't get a excetion if I 
>> union >
>> two polygon anyway.
>>
>> Why it happened and how to solve it?
>>
>>
>>
>> the following is test.xml written by me:
>>
>> <run>
>>   <precisionModel type="FLOATING" />
>> <case>
>>   <desc>A/A-3-2-1: two polygons touching at multiple points
>> [dim(0){A.A.Bdy.CP = B.A.Bdy.CP}, dim(0){A.A.Bdy.V = B.A.Bdy.V}]</desc>
>>   <a>POLYGON( (-40489.278096372727 4372.207298020518,-40296.371428571423
>> 4384.328571428571,-40288.871021184132 
>> 4292.242313959804,-40473.478571428568
>> 4280.385714285714,-40489.278096372727 4372.207298020518))</a>
>>   <b>POLYGON( (-40539.639285714278 4369.042857142857,-40372.370476402626
>> 4379.553177980468,-40369.146156502444 
>> 4148.052935215692,-40519.282142857141
>> 4149.947619047619,-40539.639285714278 4369.042857142857))</b>
>> <test>
>>   <op name="union" arg1="A" arg2="B" arg3="FF2F01212">true</op>
>>   </test>
>>   </case>
>> </run>
>>
>> this is the exception message:
>>
>> Exception: TopologyException: no outgoing dirEdge found
>> (-40539.6,4369.04,1.7e-3
>> 08)
>>
>> thanks
> jingping xie
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.osgeo.org/pipermail/geos-devel/attachments/20050427/497d533d/attachment.html
From jingping.xie at jicoux.com  Wed Apr 27 00:11:42 2005
From: jingping.xie at jicoux.com (jingping.xie)
Date: Fri Nov  2 20:52:41 2007
Subject: [geos-devel] Re: why this exception  happened
Message-ID: <004801c54adf$38ea2a80$0c08a8c0@jingpingxie>

I tried with current CVS and the exception is thrown also  in the 
environment of  VisualStudio.

geos-cvs.tar.bz2

jingping xie
  ----- Original Message ----- 
  From: jingping.xie
  To: geos-devel@geos.refractions.net
  Sent: Wednesday, April 27, 2005 11:25 AM
  Subject: Re: why this exception happened


  Thanks a lot,,strk.

  I compiled the veriosn of "[2004/12/16] geos-2.1.1.tar.bz2" with 
VisualStudio.

  and it got complie error, so I  made the following change.

  $B-!(Bchange the file name of "source\headers\geos\platform.h.vc" to 
"source\headers\geos\platform.h",
  "source\headers\geos\version.h.in" to "source\headers\geos\version.h".

  $B-"(Bdownload "Stackwalker.h","Stackwalker.cpp" from www.codeproject.com , 
then add them to the folder of "\source\test"

  $B-#(Bremove the following files from solution
  remove 
"BasicCoordinateList.cpp","CoordinateList.cpp","CoordinateListFactory.cpp","PointCoordinateList.cpp" 
from "Source File\geom\"
  remove "CPCLException.cpp","CustomPointCoordinateList.cpp" from "Source 
File\examples\"

  $B-$(Badd the following files to solution
  add "Profiler.cpp" to "Source Files\util"
  add 
"CoordinateSequenceFactory.cpp","DefaultCoordinateSequenceFactory.cpp","DefaultCoordinateSequence.cpp","CoordinateSequence.cpp" 
to "Source Files\geom"

  add 
"ElevationMatrix.cpp","ElevationMatrixCell.cpp","ElevationMatrixFilter.cpp" 
to "Source Files\geom\operation\overlay"

  that's all
  jingping xie



  >Xie, I tried with current CVS and the exception is not thrown.
  >What version are you using ?
  >--strk;

  >On Tue, Apr 26, 2005 at 04:20:25PM +0900, jingping.xie wrote:
  >> All
  >>
  >> When I make two polygon booled operation for example union operation,
  >> somtimes one exception happened.
  >>
  >> the two polygon is all valid, I think it shouldn't get a excetion if I 
union >
  >> two polygon anyway.
  >>
  >> Why it happened and how to solve it?
  >>
  >>
  >>
  >> the following is test.xml written by me:
  >>
  >> <run>
  >>   <precisionModel type="FLOATING" />
  >> <case>
  >>   <desc>A/A-3-2-1: two polygons touching at multiple points
  >> [dim(0){A.A.Bdy.CP = B.A.Bdy.CP}, dim(0){A.A.Bdy.V = B.A.Bdy.V}]</desc>
  >>   <a>POLYGON( (-40489.278096372727 
4372.207298020518,-40296.371428571423
  >> 4384.328571428571,-40288.871021184132 
4292.242313959804,-40473.478571428568
  >> 4280.385714285714,-40489.278096372727 4372.207298020518))</a>
  >>   <b>POLYGON( (-40539.639285714278 
4369.042857142857,-40372.370476402626
  >> 4379.553177980468,-40369.146156502444 
4148.052935215692,-40519.282142857141
  >> 4149.947619047619,-40539.639285714278 4369.042857142857))</b>
  >> <test>
  >>   <op name="union" arg1="A" arg2="B" arg3="FF2F01212">true</op>
  >>   </test>
  >>   </case>
  >> </run>
  >>
  >> this is the exception message:
  >>
  >> Exception: TopologyException: no outgoing dirEdge found
  >> (-40539.6,4369.04,1.7e-3
  >> 08)
  >>
  >> thanks
  > jingping xie
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.osgeo.org/pipermail/geos-devel/attachments/20050427/d09a661a/attachment.html
From nil5-ksa at yandex.ru  Fri Apr 29 13:01:13 2005
From: nil5-ksa at yandex.ru (nil5-ksa)
Date: Fri Nov  2 20:52:41 2007
Subject: [geos-devel] About LineSegment and its shifting
Message-ID: <42726859.000006.28403@mfront7.yandex.ru>

Hi, all

I have one LineSegment. And I want to get another LineSegment with points, that calculates with next algorithm.
I create two perpendiculars to my LineString in its end points. Both perpendiculars have same and fixed length. 
Resulting LineString have coordinates given by this algorithm.
 
Are there in GEOS any abilities to create this LineString?

Sergey Karin

From strk at refractions.net  Fri Apr 29 13:05:45 2005
From: strk at refractions.net (strk@refractions.net)
Date: Fri Nov  2 20:52:41 2007
Subject: [geos-devel] About LineSegment and its shifting
In-Reply-To: <42726859.000006.28403@mfront7.yandex.ru>
References: <42726859.000006.28403@mfront7.yandex.ru>
Message-ID: <20050429170545.GC96157@freek.keybit.net>

On Fri, Apr 29, 2005 at 09:01:13PM +0400, nil5-ksa wrote:
> Hi, all
> 
> I have one LineSegment. And I want to get another LineSegment with points, that calculates with next algorithm.
> I create two perpendiculars to my LineString in its end points. Both perpendiculars have same and fixed length. 
> Resulting LineString have coordinates given by this algorithm.
>  
> Are there in GEOS any abilities to create this LineString?
> 
> Sergey Karin

It is possible, but I don't know if the resulting LineString
is simple in OGC terms. It takes 6 points for how I see it.

--strk;

From strk at refractions.net  Fri Apr 29 13:34:58 2005
From: strk at refractions.net (strk@refractions.net)
Date: Fri Nov  2 20:52:41 2007
Subject: [geos-devel] WKB parser templates status
In-Reply-To: <20050420172256.GY88619@freek.keybit.net>
References: <20050420101432.GL88619@freek.keybit.net>
	<42663374.5000902@pavlenko.uklinux.net>
	<20050420110748.GP88619@freek.keybit.net>
	<20050420172256.GY88619@freek.keybit.net>
Message-ID: <20050429173458.GA96761@freek.keybit.net>

The template classes for WKB parser seems to be in a usable
state. This is a report and a request for testing and/or
discussing the idea beyond them.

WKB parser contains the first implementation of template
classes into the GEOS code base. And my first implementation
also. For the way I get it templates provide good performance
w/out loosing the lack of compiler control we have in the
C world with macros.

<rant>
I like the idea, as we're developing
free software, not one of those black boxes that require
object-level extensibility as a mean of closing the sources
(isn't this a use for virtual functions?).
</rant>

Beside that template function can make code bigger, as every
possible parameter will result in a class implementation
duplication. WKB parsing was a good candidate as Martin idea
of 'extensibility' has potentially two uses: a streamed WKB
and a buffered WKB, of which only the second is actually
implemented.

In GEOS this became:
	template <class T> ByteOrderDataInStreamT;
	template <class T> WKBWriterT;
	template <class T> WKBReaderT;

The parameter is something that can be .read(where, howmany)
from for WKBReaderT and ByteOrderDataInStreamT and something
that can be .write(what, howmany) to for WKBWriterT.
"where" and "what" are 'pointer-to-byte' types.

I added a typedef for 'byte' in geos/geom.h:

	typedef unsigned char byte;

A typedef for a convenient WKB parser parameter in geos/io.h:

	typedef basic_stringstream<byte> biostringstream;

And typedefs for "default" template class instances in
their respective headers (geos/WKBWriterT.h and geos/WKBReaderT.h):

	typedef WKBWriterT<biostringstream> WKBWriter;
	typedef WKBReaderT<biostringstream> WKBReader;

All defininions will be available by including the geos.h header itself.

doc/example.cpp contains example code, where WKBWriter and WKBReader
are used to double-check parser correctness by writing WKB, reading
it back and comparing IN and OUT using the compareTo() function.

There is a single question left on this regard (comparing)

	1) The ::compareTo() does not consider LINEARRING and LINESTRING
	   as the same thing. Should it ? There's nothing as LINEARRING
	   in the WKB spec, so the OUT geometry (the one read from WKB)
	   will *never* match the IN if that is a LINEARRING.
	   Using ::normalize() does not help, but does probably change
	   vertex orders, which somehow *invalidate* the test as WKB
	   reading and writing should not change vertex order.
	   Current code in doc/example.cpp uses normalize() and
	   compareTo().

Code and documentation (doxygen) is in CVS.

--strk;

